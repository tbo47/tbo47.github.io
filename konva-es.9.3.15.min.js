var li=Math.PI/180;function di(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}var Gt=typeof global<"u"?global:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},G={_global:Gt,version:"@@version",isBrowser:di(),isUnminified:/param/.test(function(a){}.toString()),dblClickWindow:400,getAngle(a){return G.angleDeg?a*li:a},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return G.DD.isDragging},isTransforming(){return G.Transformer?.isTransforming()},isDragReady(){return!!G.DD.node},releaseCanvasOnDestroy:!0,document:Gt.document,_injectGlobal(a){Gt.Konva=a}},L=a=>{G[a.prototype.getClassName()]=a};G._injectGlobal(G);var j=class a{constructor(e=[1,0,0,1,0,0]){this.dirty=!1;this.m=e&&e.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new a(this.m)}copyInto(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}point(e){var t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}translate(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}scale(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}rotate(e){var t=Math.cos(e),r=Math.sin(e),i=this.m[0]*t+this.m[2]*r,n=this.m[1]*t+this.m[3]*r,s=this.m[0]*-r+this.m[2]*t,o=this.m[1]*-r+this.m[3]*t;return this.m[0]=i,this.m[1]=n,this.m[2]=s,this.m[3]=o,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(e,t){var r=this.m[0]+this.m[2]*t,i=this.m[1]+this.m[3]*t,n=this.m[2]+this.m[0]*e,s=this.m[3]+this.m[1]*e;return this.m[0]=r,this.m[1]=i,this.m[2]=n,this.m[3]=s,this}multiply(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],r=this.m[1]*e.m[0]+this.m[3]*e.m[1],i=this.m[0]*e.m[2]+this.m[2]*e.m[3],n=this.m[1]*e.m[2]+this.m[3]*e.m[3],s=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],o=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=n,this.m[4]=s,this.m[5]=o,this}invert(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,n=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=n,this.m[4]=s,this.m[5]=o,this}getMatrix(){return this.m}decompose(){var e=this.m[0],t=this.m[1],r=this.m[2],i=this.m[3],n=this.m[4],s=this.m[5],o=e*i-t*r;let h={x:n,y:s,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||t!=0){var l=Math.sqrt(e*e+t*t);h.rotation=t>0?Math.acos(e/l):-Math.acos(e/l),h.scaleX=l,h.scaleY=o/l,h.skewX=(e*r+t*i)/o,h.skewY=0}else if(r!=0||i!=0){var d=Math.sqrt(r*r+i*i);h.rotation=Math.PI/2-(i>0?Math.acos(-r/d):-Math.acos(r/d)),h.scaleX=o/d,h.scaleY=d,h.skewX=0,h.skewY=(e*r+t*i)/o}return h.rotation=m._getRotation(h.rotation),h}},ui="[object Array]",fi="[object Number]",ci="[object String]",gi="[object Boolean]",mi=Math.PI/180,pi=180/Math.PI,ve="#",bi="",vi="0",Si="Konva warning: ",Ye="Konva error: ",_i="rgb(",Se={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},Ci=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,Qt=[],yi=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(a){setTimeout(a,60)},m={_isElement(a){return!!(a&&a.nodeType==1)},_isFunction(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isPlainObject(a){return!!a&&a.constructor===Object},_isArray(a){return Object.prototype.toString.call(a)===ui},_isNumber(a){return Object.prototype.toString.call(a)===fi&&!isNaN(a)&&isFinite(a)},_isString(a){return Object.prototype.toString.call(a)===ci},_isBoolean(a){return Object.prototype.toString.call(a)===gi},isObject(a){return a instanceof Object},isValidSelector(a){if(typeof a!="string")return!1;var e=a[0];return e==="#"||e==="."||e===e.toUpperCase()},_sign(a){return a===0||a>0?1:-1},requestAnimFrame(a){Qt.push(a),Qt.length===1&&yi(function(){let e=Qt;Qt=[],e.forEach(function(t){t()})})},createCanvasElement(){var a=document.createElement("canvas");try{a.style=a.style||{}}catch{}return a},createImageElement(){return document.createElement("img")},_isInDocument(a){for(;a=a.parentNode;)if(a==document)return!0;return!1},_urlToImage(a,e){var t=m.createImageElement();t.onload=function(){e(t)},t.src=a},_rgbToHex(a,e,t){return((1<<24)+(a<<16)+(e<<8)+t).toString(16).slice(1)},_hexToRgb(a){a=a.replace(ve,bi);var e=parseInt(a,16);return{r:e>>16&255,g:e>>8&255,b:e&255}},getRandomColor(){for(var a=(Math.random()*16777215<<0).toString(16);a.length<6;)a=vi+a;return ve+a},getRGB(a){var e;return a in Se?(e=Se[a],{r:e[0],g:e[1],b:e[2]}):a[0]===ve?this._hexToRgb(a.substring(1)):a.substr(0,4)===_i?(e=Ci.exec(a.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA(a){return a=a||"black",m._namedColorToRBA(a)||m._hex3ColorToRGBA(a)||m._hex4ColorToRGBA(a)||m._hex6ColorToRGBA(a)||m._hex8ColorToRGBA(a)||m._rgbColorToRGBA(a)||m._rgbaColorToRGBA(a)||m._hslColorToRGBA(a)},_namedColorToRBA(a){var e=Se[a.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(a){if(a.indexOf("rgb(")===0){a=a.match(/rgb\(([^)]+)\)/)[1];var e=a.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(a){if(a.indexOf("rgba(")===0){a=a.match(/rgba\(([^)]+)\)/)[1];var e=a.split(/ *, */).map((t,r)=>t.slice(-1)==="%"?r===3?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(a){if(a[0]==="#"&&a.length===9)return{r:parseInt(a.slice(1,3),16),g:parseInt(a.slice(3,5),16),b:parseInt(a.slice(5,7),16),a:parseInt(a.slice(7,9),16)/255}},_hex6ColorToRGBA(a){if(a[0]==="#"&&a.length===7)return{r:parseInt(a.slice(1,3),16),g:parseInt(a.slice(3,5),16),b:parseInt(a.slice(5,7),16),a:1}},_hex4ColorToRGBA(a){if(a[0]==="#"&&a.length===5)return{r:parseInt(a[1]+a[1],16),g:parseInt(a[2]+a[2],16),b:parseInt(a[3]+a[3],16),a:parseInt(a[4]+a[4],16)/255}},_hex3ColorToRGBA(a){if(a[0]==="#"&&a.length===4)return{r:parseInt(a[1]+a[1],16),g:parseInt(a[2]+a[2],16),b:parseInt(a[3]+a[3],16),a:1}},_hslColorToRGBA(a){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(a)){let[e,...t]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(a),r=Number(t[0])/360,i=Number(t[1])/100,n=Number(t[2])/100,s,o,h;if(i===0)return h=n*255,{r:Math.round(h),g:Math.round(h),b:Math.round(h),a:1};n<.5?s=n*(1+i):s=n+i-n*i;let l=2*n-s,d=[0,0,0];for(let f=0;f<3;f++)o=r+1/3*-(f-1),o<0&&o++,o>1&&o--,6*o<1?h=l+(s-l)*6*o:2*o<1?h=s:3*o<2?h=l+(s-l)*(2/3-o)*6:h=l,d[f]=h*255;return{r:Math.round(d[0]),g:Math.round(d[1]),b:Math.round(d[2]),a:1}}},haveIntersection(a,e){return!(e.x>a.x+a.width||e.x+e.width<a.x||e.y>a.y+a.height||e.y+e.height<a.y)},cloneObject(a){var e={};for(var t in a)this._isPlainObject(a[t])?e[t]=this.cloneObject(a[t]):this._isArray(a[t])?e[t]=this.cloneArray(a[t]):e[t]=a[t];return e},cloneArray(a){return a.slice(0)},degToRad(a){return a*mi},radToDeg(a){return a*pi},_degToRad(a){return m.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),m.degToRad(a)},_radToDeg(a){return m.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),m.radToDeg(a)},_getRotation(a){return G.angleDeg?m.radToDeg(a):a},_capitalize(a){return a.charAt(0).toUpperCase()+a.slice(1)},throw(a){throw new Error(Ye+a)},error(a){console.error(Ye+a)},warn(a){G.showWarnings&&console.warn(Si+a)},each(a,e){for(var t in a)e(t,a[t])},_inRange(a,e,t){return e<=a&&a<t},_getProjectionToSegment(a,e,t,r,i,n){var s,o,h,l=(a-t)*(a-t)+(e-r)*(e-r);if(l==0)s=a,o=e,h=(i-t)*(i-t)+(n-r)*(n-r);else{var d=((i-a)*(t-a)+(n-e)*(r-e))/l;d<0?(s=a,o=e,h=(a-i)*(a-i)+(e-n)*(e-n)):d>1?(s=t,o=r,h=(t-i)*(t-i)+(r-n)*(r-n)):(s=a+d*(t-a),o=e+d*(r-e),h=(s-i)*(s-i)+(o-n)*(o-n))}return[s,o,h]},_getProjectionToLine(a,e,t){var r=m.cloneObject(a),i=Number.MAX_VALUE;return e.forEach(function(n,s){if(!(!t&&s===e.length-1)){var o=e[(s+1)%e.length],h=m._getProjectionToSegment(n.x,n.y,o.x,o.y,a.x,a.y),l=h[0],d=h[1],f=h[2];f<i&&(r.x=l,r.y=d,i=f)}}),r},_prepareArrayForTween(a,e,t){var r,i=[],n=[];if(a.length>e.length){var s=e;e=a,a=s}for(r=0;r<a.length;r+=2)i.push({x:a[r],y:a[r+1]});for(r=0;r<e.length;r+=2)n.push({x:e[r],y:e[r+1]});var o=[];return n.forEach(function(h){var l=m._getProjectionToLine(h,i,t);o.push(l.x),o.push(l.y)}),o},_prepareToStringify(a){var e;a.visitedByCircularReferenceRemoval=!0;for(var t in a)if(a.hasOwnProperty(t)&&a[t]&&typeof a[t]=="object"){if(e=Object.getOwnPropertyDescriptor(a,t),a[t].visitedByCircularReferenceRemoval||m._isElement(a[t]))if(e.configurable)delete a[t];else return null;else if(m._prepareToStringify(a[t])===null)if(e.configurable)delete a[t];else return null}return delete a.visitedByCircularReferenceRemoval,a},_assign(a,e){for(var t in e)a[t]=e[t];return a},_getFirstPointerId(a){return a.touches?a.changedTouches[0].identifier:a.pointerId||999},releaseCanvas(...a){G.releaseCanvasOnDestroy&&a.forEach(e=>{e.width=0,e.height=0})},drawRoundedRectPath(a,e,t,r){let i=0,n=0,s=0,o=0;typeof r=="number"?i=n=s=o=Math.min(r,e/2,t/2):(i=Math.min(r[0]||0,e/2,t/2),n=Math.min(r[1]||0,e/2,t/2),o=Math.min(r[2]||0,e/2,t/2),s=Math.min(r[3]||0,e/2,t/2)),a.moveTo(i,0),a.lineTo(e-n,0),a.arc(e-n,n,n,Math.PI*3/2,0,!1),a.lineTo(e,t-o),a.arc(e-o,t-o,o,0,Math.PI/2,!1),a.lineTo(s,t),a.arc(s,t-s,s,Math.PI/2,Math.PI,!1),a.lineTo(0,i),a.arc(i,i,i,Math.PI,Math.PI*3/2,!1)}};function Ct(a){return m._isString(a)?'"'+a+'"':Object.prototype.toString.call(a)==="[object Number]"||m._isBoolean(a)?a:Object.prototype.toString.call(a)}function Zt(a){return a>255?255:a<0?0:Math.round(a)}function _(){if(G.isUnminified)return function(a,e){return m._isNumber(a)||m.warn(Ct(a)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),a}}function Mt(a){if(G.isUnminified)return function(e,t){let r=m._isNumber(e),i=m._isArray(e)&&e.length==a;return!r&&!i&&m.warn(Ct(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>('+a+")"),e}}function Ht(){if(G.isUnminified)return function(a,e){var t=m._isNumber(a),r=a==="auto";return t||r||m.warn(Ct(a)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),a}}function ft(){if(G.isUnminified)return function(a,e){return m._isString(a)||m.warn(Ct(a)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),a}}function _e(){if(G.isUnminified)return function(a,e){let t=m._isString(a),r=Object.prototype.toString.call(a)==="[object CanvasGradient]"||a&&a.addColorStop;return t||r||m.warn(Ct(a)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),a}}function Xe(){if(G.isUnminified)return function(a,e){let t=Int8Array?Object.getPrototypeOf(Int8Array):null;return t&&a instanceof t||(m._isArray(a)?a.forEach(function(r){m._isNumber(r)||m.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):m.warn(Ct(a)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),a}}function J(){if(G.isUnminified)return function(a,e){var t=a===!0||a===!1;return t||m.warn(Ct(a)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),a}}function Ue(a){if(G.isUnminified)return function(e,t){return e==null||m.isObject(e)||m.warn(Ct(e)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+a),e}}var Vt="get",zt="set",u={addGetterSetter(a,e,t,r,i){u.addGetter(a,e,t),u.addSetter(a,e,r,i),u.addOverloadedGetterSetter(a,e)},addGetter(a,e,t){var r=Vt+m._capitalize(e);a.prototype[r]=a.prototype[r]||function(){var i=this.attrs[e];return i===void 0?t:i}},addSetter(a,e,t,r){var i=zt+m._capitalize(e);a.prototype[i]||u.overWriteSetter(a,e,t,r)},overWriteSetter(a,e,t,r){var i=zt+m._capitalize(e);a.prototype[i]=function(n){return t&&n!==void 0&&n!==null&&(n=t.call(this,n,e)),this._setAttr(e,n),r&&r.call(this),this}},addComponentsGetterSetter(a,e,t,r,i){var n=t.length,s=m._capitalize,o=Vt+s(e),h=zt+s(e),l,d;a.prototype[o]=function(){var c={};for(l=0;l<n;l++)d=t[l],c[d]=this.getAttr(e+s(d));return c};var f=Ue(t);a.prototype[h]=function(c){var g=this.attrs[e],v;r&&(c=r.call(this,c)),f&&f.call(this,c,e);for(v in c)c.hasOwnProperty(v)&&this._setAttr(e+s(v),c[v]);return c||t.forEach(p=>{this._setAttr(e+s(p),void 0)}),this._fireChangeEvent(e,g,c),i&&i.call(this),this},u.addOverloadedGetterSetter(a,e)},addOverloadedGetterSetter(a,e){var t=m._capitalize(e),r=zt+t,i=Vt+t;a.prototype[e]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter(a,e,t,r){m.error("Adding deprecated "+e);var i=Vt+m._capitalize(e),n=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[i]=function(){m.error(n);var s=this.attrs[e];return s===void 0?t:s},u.addSetter(a,e,r,function(){m.error(n)}),u.addOverloadedGetterSetter(a,e)},backCompat(a,e){m.each(e,function(t,r){var i=a.prototype[r],n=Vt+m._capitalize(t),s=zt+m._capitalize(t);function o(){i.apply(this,arguments),m.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+r+'" instead.')}a.prototype[t]=o,a.prototype[n]=o,a.prototype[s]=o})},afterSetFilter(){this._filterUpToDate=!1}};function xi(a){var e=[],t=a.length,r=m,i,n;for(i=0;i<t;i++)n=a[i],r._isNumber(n)?n=Math.round(n*1e3)/1e3:r._isString(n)||(n=n+""),e.push(n);return e}var qe=",",wi="(",Gi=")",Pi="([",Ti="])",Ei=";",Ai="()",Ri="=",Ke=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],ki=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],Mi=100,Pt=class{constructor(e){this.canvas=e,G.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){var r=this.traceArr,i=r.length,n="",s,o,h,l;for(s=0;s<i;s++)o=r[s],h=o.method,h?(l=o.args,n+=h,e?n+=Ai:m._isArray(l[0])?n+=Pi+l.join(qe)+Ti:(t&&(l=l.map(d=>typeof d=="number"?Math.floor(d):d)),n+=wi+l.join(qe)+Gi)):(n+=o.property,e||(n+=Ri+o.val)),n+=Ei;return n}clearTrace(){this.traceArr=[]}_trace(e){var t=this.traceArr,r;t.push(e),r=t.length,r>=Mi&&t.shift()}reset(){var e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){var t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){let t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){var t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){let t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}setAttr(e,t){this._context[e]=t}arc(e,t,r,i,n,s){this._context.arc(e,t,r,i,n,s)}arcTo(e,t,r,i,n){this._context.arcTo(e,t,r,i,n)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,r,i,n,s){this._context.bezierCurveTo(e,t,r,i,n,s)}clearRect(e,t,r,i){this._context.clearRect(e,t,r,i)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){var r=arguments;if(r.length===2)return this._context.createImageData(e,t);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,r,i){return this._context.createLinearGradient(e,t,r,i)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,r,i,n,s){return this._context.createRadialGradient(e,t,r,i,n,s)}drawImage(e,t,r,i,n,s,o,h,l){var d=arguments,f=this._context;d.length===3?f.drawImage(e,t,r):d.length===5?f.drawImage(e,t,r,i,n):d.length===9&&f.drawImage(e,t,r,i,n,s,o,h,l)}ellipse(e,t,r,i,n,s,o,h){this._context.ellipse(e,t,r,i,n,s,o,h)}isPointInPath(e,t,r,i){return r?this._context.isPointInPath(r,e,t,i):this._context.isPointInPath(e,t,i)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,r,i){this._context.fillRect(e,t,r,i)}strokeRect(e,t,r,i){this._context.strokeRect(e,t,r,i)}fillText(e,t,r,i){i?this._context.fillText(e,t,r,i):this._context.fillText(e,t,r)}measureText(e){return this._context.measureText(e)}getImageData(e,t,r,i){return this._context.getImageData(e,t,r,i)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,r,i){this._context.rect(e,t,r,i)}roundRect(e,t,r,i,n){this._context.roundRect(e,t,r,i,n)}putImageData(e,t,r){this._context.putImageData(e,t,r)}quadraticCurveTo(e,t,r,i){this._context.quadraticCurveTo(e,t,r,i)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,r,i,n,s){this._context.setTransform(e,t,r,i,n,s)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,r,i){this._context.strokeText(e,t,r,i)}transform(e,t,r,i,n,s){this._context.transform(e,t,r,i,n,s)}translate(e,t){this._context.translate(e,t)}_enableTrace(){var e=this,t=Ke.length,r=this.setAttr,i,n,s=function(o){var h=e[o],l;e[o]=function(){return n=xi(Array.prototype.slice.call(arguments,0)),l=h.apply(e,arguments),e._trace({method:o,args:n}),l}};for(i=0;i<t;i++)s(Ke[i]);e.setAttr=function(){r.apply(e,arguments);var o=arguments[0],h=arguments[1];(o==="shadowOffsetX"||o==="shadowOffsetY"||o==="shadowBlur")&&(h=h/this.canvas.getPixelRatio()),e._trace({property:o,val:h})}}_applyGlobalCompositeOperation(e){let t=e.attrs.globalCompositeOperation;var r=!t||t==="source-over";r||this.setAttr("globalCompositeOperation",t)}};ki.forEach(function(a){Object.defineProperty(Pt.prototype,a,{get(){return this._context[a]},set(e){this._context[a]=e}})});var $t=class extends Pt{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){var t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){var t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){let t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){let t=e.fill(),r=e.getFillPriority();if(t&&r==="color"){this._fillColor(e);return}let i=e.getFillPatternImage();if(i&&r==="pattern"){this._fillPattern(e);return}let n=e.getFillLinearGradientColorStops();if(n&&r==="linear-gradient"){this._fillLinearGradient(e);return}let s=e.getFillRadialGradientColorStops();if(s&&r==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):i?this._fillPattern(e):n?this._fillLinearGradient(e):s&&this._fillRadialGradient(e)}_strokeLinearGradient(e){let t=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),i=e.getStrokeLinearGradientColorStops(),n=this.createLinearGradient(t.x,t.y,r.x,r.y);if(i){for(var s=0;s<i.length;s+=2)n.addColorStop(i[s],i[s+1]);this.setAttr("strokeStyle",n)}}_stroke(e){var t=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var n=e.getStrokeLinearGradientColorStops();n?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var t=e.getShadowRGBA()??"black",r=e.getShadowBlur()??5,i=e.getShadowOffset()??{x:0,y:0},n=e.getAbsoluteScale(),s=this.canvas.getPixelRatio(),o=n.x*s,h=n.y*s;this.setAttr("shadowColor",t),this.setAttr("shadowBlur",r*Math.min(Math.abs(o),Math.abs(h))),this.setAttr("shadowOffsetX",i.x*o),this.setAttr("shadowOffsetY",i.y*h)}},te=class extends Pt{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){let n=e.getStrokeScaleEnabled();if(!n){this.save();var t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(e);var r=e.hitStrokeWidth(),i=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),n||this.restore()}}};var ee;function Ni(){if(ee)return ee;var a=m.createCanvasElement(),e=a.getContext("2d");return ee=function(){var t=G._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/r}(),m.releaseCanvas(a),ee}var Tt=class{constructor(e){this.pixelRatio=1;this.width=0;this.height=0;this.isCache=!1;var t=e||{},r=t.pixelRatio||G.pixelRatio||Ni();this.pixelRatio=r,this._canvas=m.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){var t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";var t=this.pixelRatio,r=this.getContext()._context;r.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";var t=this.pixelRatio,r=this.getContext()._context;r.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch{try{return this._canvas.toDataURL()}catch(i){return m.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};u.addGetterSetter(Tt,"pixelRatio",void 0,_());var rt=class extends Tt{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new $t(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}},yt=class extends Tt{constructor(t={width:0,height:0}){super(t);this.hitCanvas=!0;this.context=new te(this),this.setSize(t.width,t.height)}};var I={get isDragging(){var a=!1;return I._dragElements.forEach(e=>{e.dragStatus==="dragging"&&(a=!0)}),a},justDragged:!1,get node(){var a;return I._dragElements.forEach(e=>{a=e.node}),a},_dragElements:new Map,_drag(a){let e=[];I._dragElements.forEach((t,r)=>{let{node:i}=t,n=i.getStage();n.setPointersPositions(a),t.pointerId===void 0&&(t.pointerId=m._getFirstPointerId(a));let s=n._changedPointerPositions.find(l=>l.id===t.pointerId);if(s){if(t.dragStatus!=="dragging"){var o=i.dragDistance(),h=Math.max(Math.abs(s.x-t.startPointerPos.x),Math.abs(s.y-t.startPointerPos.y));if(h<o||(i.startDrag({evt:a}),!i.isDragging()))return}i._setDragPosition(a,t),e.push(i)}}),e.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:a},!0)})},_endDragBefore(a){let e=[];I._dragElements.forEach(t=>{let{node:r}=t,i=r.getStage();if(a&&i.setPointersPositions(a),!i._changedPointerPositions.find(o=>o.id===t.pointerId))return;(t.dragStatus==="dragging"||t.dragStatus==="stopped")&&(I.justDragged=!0,G._mouseListenClick=!1,G._touchListenClick=!1,G._pointerListenClick=!1,t.dragStatus="stopped");let s=t.node.getLayer()||t.node instanceof G.Stage&&t.node;s&&e.indexOf(s)===-1&&e.push(s)}),e.forEach(t=>{t.draw()})},_endDragAfter(a){I._dragElements.forEach((e,t)=>{e.dragStatus==="stopped"&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:a},!0),e.dragStatus!=="dragging"&&I._dragElements.delete(t)})}};G.isBrowser&&(window.addEventListener("mouseup",I._endDragBefore,!0),window.addEventListener("touchend",I._endDragBefore,!0),window.addEventListener("mousemove",I._drag),window.addEventListener("touchmove",I._drag),window.addEventListener("mouseup",I._endDragAfter,!1),window.addEventListener("touchend",I._endDragAfter,!1));var ie="absoluteOpacity",re="allEventListeners",bt="absoluteTransform",je="absoluteScale",Et="canvas",Li="Change",Oi="children",Fi="konva",Ce="listening",Je="mouseenter",Qe="mouseleave";var Ze="set",$e="Shape",ne=" ",tr="stage",xt="transform",Di="Stage",ye="visible",Ii=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(ne),Bi=1,y=class a{constructor(e){this._id=Bi++;this.eventListeners={};this.attrs={};this.index=0;this._allEventListeners=null;this.parent=null;this._cache=new Map;this._attachedDepsListeners=new Map;this._lastPos=null;this._batchingTransformChange=!1;this._needClearTransformCache=!1;this._filterUpToDate=!1;this._isUnderCache=!1;this._dragEventId=null;this._shouldFireChangeEvents=!1;this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===xt||e===bt)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,t){var r=this._cache.get(e),i=e===xt||e===bt,n=r===void 0||i&&r.dirty===!0;return n&&(r=t.call(this),this._cache.set(e,r)),r}_calculate(e,t,r){if(!this._attachedDepsListeners.get(e)){let i=t.map(n=>n+"Change.konva").join(ne);this.on(i,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(Et)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===bt&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Et)){let{scene:e,filter:t,hit:r}=this._cache.get(Et);m.releaseCanvas(e,t,r),this._cache.delete(Et)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){var t=e||{},r={};(t.x===void 0||t.y===void 0||t.width===void 0||t.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));var i=Math.ceil(t.width||r.width),n=Math.ceil(t.height||r.height),s=t.pixelRatio,o=t.x===void 0?Math.floor(r.x):t.x,h=t.y===void 0?Math.floor(r.y):t.y,l=t.offset||0,d=t.drawBorder||!1,f=t.hitCanvasPixelRatio||1;if(!i||!n){m.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}let c=Math.abs(Math.round(r.x)-o)>.5?1:0,g=Math.abs(Math.round(r.y)-h)>.5?1:0;i+=l*2+c,n+=l*2+g,o-=l,h-=l;var v=new rt({pixelRatio:s,width:i,height:n}),p=new rt({pixelRatio:s,width:0,height:0,willReadFrequently:!0}),b=new yt({pixelRatio:f,width:i,height:n}),S=v.getContext(),P=b.getContext();return b.isCache=!0,v.isCache=!0,this._cache.delete(Et),this._filterUpToDate=!1,t.imageSmoothingEnabled===!1&&(v.getContext()._context.imageSmoothingEnabled=!1,p.getContext()._context.imageSmoothingEnabled=!1),S.save(),P.save(),S.translate(-o,-h),P.translate(-o,-h),this._isUnderCache=!0,this._clearSelfAndDescendantCache(ie),this._clearSelfAndDescendantCache(je),this.drawScene(v,this),this.drawHit(b,this),this._isUnderCache=!1,S.restore(),P.restore(),d&&(S.save(),S.beginPath(),S.rect(0,0,i,n),S.closePath(),S.setAttr("strokeStyle","red"),S.setAttr("lineWidth",5),S.stroke(),S.restore()),this._cache.set(Et,{scene:v,filter:p,hit:b,x:o,y:h}),this._requestDraw(),this}isCached(){return this._cache.has(Et)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){var r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],i=1/0,n=1/0,s=-1/0,o=-1/0,h=this.getAbsoluteTransform(t);return r.forEach(function(l){var d=h.point(l);i===void 0&&(i=s=d.x,n=o=d.y),i=Math.min(i,d.x),n=Math.min(n,d.y),s=Math.max(s,d.x),o=Math.max(o,d.y)}),{x:i,y:n,width:s-i,height:o-n}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);let t=this._getCanvasCache();e.translate(t.x,t.y);var r=this._getCachedSceneCanvas(),i=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/i,r.height/i),e.restore()}_drawCachedHitCanvas(e){var t=this._getCanvasCache(),r=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){var e=this.filters(),t=this._getCanvasCache(),r=t.scene,i=t.filter,n=i.getContext(),s,o,h,l;if(e){if(!this._filterUpToDate){var d=r.pixelRatio;i.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(s=e.length,n.clear(),n.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),o=n.getImageData(0,0,i.getWidth(),i.getHeight()),h=0;h<s;h++){if(l=e[h],typeof l!="function"){m.error("Filter should be type of function, but got "+typeof l+" instead. Please check correct filters");continue}l.call(this,o),n.putImageData(o,0,0)}}catch(f){m.error("Unable to apply filter. "+f.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return i}return r}on(e,t){if(this._cache&&this._cache.delete(re),arguments.length===3)return this._delegate.apply(this,arguments);var r=e.split(ne),i=r.length,n,s,o,h,l;for(n=0;n<i;n++)s=r[n],o=s.split("."),h=o[0],l=o[1]||"",this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push({name:l,handler:t});return this}off(e,t){var r=(e||"").split(ne),i=r.length,n,s,o,h,l,d;if(this._cache&&this._cache.delete(re),!e)for(s in this.eventListeners)this._off(s);for(n=0;n<i;n++)if(o=r[n],h=o.split("."),l=h[0],d=h[1],l)this.eventListeners[l]&&this._off(l,d,t);else for(s in this.eventListeners)this._off(s,d,t);return this}dispatchEvent(e){var t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(r){t.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,r){var i=this;this.on(e,function(n){for(var s=n.target.findAncestors(t,!0,i),o=0;o<s.length;o++)n=m.cloneObject(n),n.currentTarget=s[o],r.call(s[o],n)})}remove(){return this.isDragging()&&this.stopDrag(),I._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(bt),this._clearSelfAndDescendantCache(ie),this._clearSelfAndDescendantCache(je),this._clearSelfAndDescendantCache(tr),this._clearSelfAndDescendantCache(ye),this._clearSelfAndDescendantCache(Ce)}_remove(){this._clearCaches();var e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){var t="get"+m._capitalize(e);return m._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){for(var e=this.getParent(),t=[];e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{var t,r;if(!e)return this;for(t in e)t!==Oi&&(r=Ze+m._capitalize(t),m._isFunction(this[r])?this[r](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(Ce,this._isListening)}_isListening(e){if(!this.listening())return!1;let r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(ye,this._isVisible)}_isVisible(e){if(!this.visible())return!1;let r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);var r=this.getLayer(),i=!1;I._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(s.node.nodeType==="Stage"||s.node.getLayer()===r)&&(i=!0)});var n=!t&&!G.hitOnDragEnabled&&(i||G.isTransforming());return this.isListening()&&this.isVisible()&&!n}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var e=this.getDepth(),t=this,r=0,i,n,s,o;function h(d){for(i=[],n=d.length,s=0;s<n;s++)o=d[s],r++,o.nodeType!==$e&&(i=i.concat(o.getChildren().slice())),o._id===t._id&&(s=n);i.length>0&&i[0].getDepth()<=e&&h(i)}let l=this.getStage();return t.nodeType!==Di&&l&&h(l.getChildren()),r}getDepth(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(xt),this._clearSelfAndDescendantCache(bt)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){let e=this.getStage();if(!e)return null;var t=e.getPointerPosition();if(!t)return null;var r=this.getAbsoluteTransform().copy();return r.invert(),r.point(t)}getAbsolutePosition(e){let t=!1,r=this.parent;for(;r;){if(r.isCached()){t=!0;break}r=r.parent}t&&!e&&(e=!0);var i=this.getAbsoluteTransform(e).getMatrix(),n=new j,s=this.offset();return n.m=i.slice(),n.translate(s.x,s.y),n.getTranslation()}setAbsolutePosition(e){let{x:t,y:r,...i}=this._clearTransform();this.attrs.x=t,this.attrs.y=r,this._clearCache(xt);var n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(e.x,e.y),e={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(i),this.setPosition({x:e.x,y:e.y}),this._clearCache(xt),this._clearSelfAndDescendantCache(bt),this}_setTransform(e){var t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){var e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){var t=e.x,r=e.y,i=this.x(),n=this.y();return t!==void 0&&(i+=t),r!==void 0&&(n+=r),this.setPosition({x:i,y:n}),this}_eachAncestorReverse(e,t){var r=[],i=this.getParent(),n,s;if(!(t&&t._id===this._id)){for(r.unshift(this);i&&(!t||i._id!==t._id);)r.unshift(i),i=i.parent;for(n=r.length,s=0;s<n;s++)e(r[s])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return m.warn("Node has no parent. moveToTop function is ignored."),!1;var e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return m.warn("Node has no parent. moveUp function is ignored."),!1;var e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return m.warn("Node has no parent. moveDown function is ignored."),!1;var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return m.warn("Node has no parent. moveToBottom function is ignored."),!1;var e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return m.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&m.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(ie,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var e=this.opacity(),t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){var e=this.getAttrs(),t,r,i,n,s;let o={attrs:{},className:this.getClassName()};for(t in e)r=e[t],s=m.isObject(r)&&!m._isPlainObject(r)&&!m._isArray(r),!s&&(i=typeof this[t]=="function"&&this[t],delete e[t],n=i?i.call(this):null,e[t]=r,n!==r&&(o.attrs[t]=r));return m._prepareToStringify(o)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,r){var i=[];t&&this._isMatch(e)&&i.push(this);for(var n=this.parent;n;){if(n===r)return i;n._isMatch(e)&&i.push(n),n=n.parent}return i}isAncestorOf(e){return!1}findAncestor(e,t,r){return this.findAncestors(e,t,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);var t=e.replace(/ /g,"").split(","),r=t.length,i,n;for(i=0;i<r;i++)if(n=t[i],m.isValidSelector(n)||(m.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),m.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),m.warn("Konva is awesome, right?")),n.charAt(0)==="#"){if(this.id()===n.slice(1))return!0}else if(n.charAt(0)==="."){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){var e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(tr,this._getStage)}_getStage(){var e=this.getParent();return e?e.getStage():null}fire(e,t={},r){return t.target=t.target||this,r?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(bt,this._getAbsoluteTransform)}_getAbsoluteTransform(e){var t;if(e)return t=new j,this._eachAncestorReverse(function(i){var n=i.transformsEnabled();n==="all"?t.multiply(i.getTransform()):n==="position"&&t.translate(i.x()-i.offsetX(),i.y()-i.offsetY())},e),t;t=this._cache.get(bt)||new j,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();var r=this.transformsEnabled();if(r==="all")t.multiply(this.getTransform());else if(r==="position"){let i=this.attrs.x||0,n=this.attrs.y||0,s=this.attrs.offsetX||0,o=this.attrs.offsetY||0;t.translate(i-s,n-o)}return t.dirty=!1,t}getAbsoluteScale(e){for(var t=this;t;)t._isUnderCache&&(e=t),t=t.getParent();let i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(xt,this._getTransform)}_getTransform(){var e=this._cache.get(xt)||new j;e.reset();var t=this.x(),r=this.y(),i=G.getAngle(this.rotation()),n=this.attrs.scaleX??1,s=this.attrs.scaleY??1,o=this.attrs.skewX||0,h=this.attrs.skewY||0,l=this.attrs.offsetX||0,d=this.attrs.offsetY||0;return(t!==0||r!==0)&&e.translate(t,r),i!==0&&e.rotate(i),(o!==0||h!==0)&&e.skew(o,h),(n!==1||s!==1)&&e.scale(n,s),(l!==0||d!==0)&&e.translate(-1*l,-1*d),e.dirty=!1,e}clone(e){var t=m.cloneObject(this.attrs),r,i,n,s,o;for(r in e)t[r]=e[r];var h=new this.constructor(t);for(r in this.eventListeners)for(i=this.eventListeners[r],n=i.length,s=0;s<n;s++)o=i[s],o.name.indexOf(Fi)<0&&(h.eventListeners[r]||(h.eventListeners[r]=[]),h.eventListeners[r].push(o));return h}_toKonvaCanvas(e){e=e||{};var t=this.getClientRect(),r=this.getStage(),i=e.x!==void 0?e.x:Math.floor(t.x),n=e.y!==void 0?e.y:Math.floor(t.y),s=e.pixelRatio||1,o=new rt({width:e.width||Math.ceil(t.width)||(r?r.width():0),height:e.height||Math.ceil(t.height)||(r?r.height():0),pixelRatio:s}),h=o.getContext();let l=new rt({width:o.width/o.pixelRatio+Math.abs(i),height:o.height/o.pixelRatio+Math.abs(n),pixelRatio:o.pixelRatio});return e.imageSmoothingEnabled===!1&&(h._context.imageSmoothingEnabled=!1),h.save(),(i||n)&&h.translate(-1*i,-1*n),this.drawScene(o,void 0,l),h.restore(),o}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};var t=e.mimeType||null,r=e.quality||null,i=this._toKonvaCanvas(e).toDataURL(t,r);return e.callback&&e.callback(i),i}toImage(e){return new Promise((t,r)=>{try{let i=e?.callback;i&&delete e.callback,m._urlToImage(this.toDataURL(e),function(n){t(n),i?.(n)})}catch(i){r(i)}})}toBlob(e){return new Promise((t,r)=>{try{let i=e?.callback;i&&delete e.callback,this.toCanvas(e).toBlob(n=>{t(n),i?.(n)},e?.mimeType,e?.quality)}catch(i){r(i)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():G.dragDistance}_off(e,t,r){var i=this.eventListeners[e],n,s,o;for(n=0;n<i.length;n++)if(s=i[n].name,o=i[n].handler,(s!=="konva"||t==="konva")&&(!t||s===t)&&(!r||r===o)){if(i.splice(n,1),i.length===0){delete this.eventListeners[e];break}n--}}_fireChangeEvent(e,t,r){this._fire(e+Li,{oldVal:t,newVal:r})}addName(e){if(!this.hasName(e)){var t=this.name(),r=t?t+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;let t=this.name();if(!t)return!1;var r=(t||"").split(/\s/g);return r.indexOf(e)!==-1}removeName(e){var t=(this.name()||"").split(/\s/g),r=t.indexOf(e);return r!==-1&&(t.splice(r,1),this.name(t.join(" "))),this}setAttr(e,t){var r=this[Ze+m._capitalize(e)];return m._isFunction(r)?r.call(this,t):this._setAttr(e,t),this}_requestDraw(){G.autoDrawEnabled&&(this.getLayer()||this.getStage())?.batchDraw()}_setAttr(e,t){var r=this.attrs[e];r===t&&!m.isObject(t)||(t==null?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,t),this._requestDraw())}_setComponentAttr(e,t,r){var i;r!==void 0&&(i=this.attrs[e],i||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=r,this._fireChangeEvent(e,i,r))}_fireAndBubble(e,t,r){t&&this.nodeType===$e&&(t.target=this);var i=(e===Je||e===Qe)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r);if(!i){this._fire(e,t);var n=(e===Je||e===Qe)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!n&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,t,r):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){let t=this._cache.get(re)??{},r=t?.[e];if(r===void 0){r=[];let i=Object.getPrototypeOf(this);for(;i;){let n=i.eventListeners?.[e]??[];r.push(...n),i=Object.getPrototypeOf(i)}t[e]=r,this._cache.set(re,t)}return r}_fire(e,t){t=t||{},t.currentTarget=this,t.type=e;let r=this._getProtoListeners(e);if(r)for(var i=0;i<r.length;i++)r[i].handler.call(this,t);let n=this.eventListeners[e];if(n)for(var i=0;i<n.length;i++)n[i].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){var t=e?e.pointerId:void 0,r=this.getStage(),i=this.getAbsolutePosition();if(r){var n=r._getPointerById(t)||r._changedPointerPositions[0]||i;I._dragElements.set(this._id,{node:this,startPointerPos:n,offset:{x:n.x-i.x,y:n.y-i.y},dragStatus:"ready",pointerId:t})}}startDrag(e,t=!0){I._dragElements.has(this._id)||this._createDragElement(e);let r=I._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){let r=this.getStage()._getPointerById(t.pointerId);if(r){var i={x:r.x-t.offset.x,y:r.y-t.offset.y},n=this.dragBoundFunc();if(n!==void 0){let s=n.call(this,i,e);s?i=s:m.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)&&(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}}stopDrag(e){let t=I._dragElements.get(this._id);t&&(t.dragStatus="stopped"),I._endDragBefore(e),I._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){let e=I._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){var t=e.evt.button!==void 0,r=!t||G.dragButtons.indexOf(e.evt.button)>=0;if(r&&!this.isDragging()){var i=!1;I._dragElements.forEach(n=>{this.isAncestorOf(n.node)&&(i=!0)}),i||this._createDragElement(e)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var e=this.getStage();if(!e)return;let t=I._dragElements.get(this._id),r=t&&t.dragStatus==="dragging",i=t&&t.dragStatus==="ready";r?this.stopDrag():i&&I._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){let t=this.getStage();if(!t)return!1;let r={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return m.haveIntersection(r,this.getClientRect())}static create(e,t){return m._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){var r=a.prototype.getClassName.call(e),i=e.children,n,s,o;t&&(e.attrs.container=t),G[r]||(m.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");let h=G[r];if(n=new h(e.attrs),i)for(s=i.length,o=0;o<s;o++)n.add(a._createNode(i[o]));return n}};y.prototype.nodeType="Node";y.prototype._attrsAffectingSize=[];y.prototype.eventListeners={};y.prototype.on.call(y.prototype,Ii,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(xt),this._clearSelfAndDescendantCache(bt)});y.prototype.on.call(y.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(ye)});y.prototype.on.call(y.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Ce)});y.prototype.on.call(y.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(ie)});var z=u.addGetterSetter;z(y,"zIndex");z(y,"absolutePosition");z(y,"position");z(y,"x",0,_());z(y,"y",0,_());z(y,"globalCompositeOperation","source-over",ft());z(y,"opacity",1,_());z(y,"name","",ft());z(y,"id","",ft());z(y,"rotation",0,_());u.addComponentsGetterSetter(y,"scale",["x","y"]);z(y,"scaleX",1,_());z(y,"scaleY",1,_());u.addComponentsGetterSetter(y,"skew",["x","y"]);z(y,"skewX",0,_());z(y,"skewY",0,_());u.addComponentsGetterSetter(y,"offset",["x","y"]);z(y,"offsetX",0,_());z(y,"offsetY",0,_());z(y,"dragDistance",null,_());z(y,"width",0,_());z(y,"height",0,_());z(y,"listening",!0,J());z(y,"preventDefault",!0,J());z(y,"filters",null,function(a){return this._filterUpToDate=!1,a});z(y,"visible",!0,J());z(y,"transformsEnabled","all",ft());z(y,"size");z(y,"dragBoundFunc");z(y,"draggable",!1,J());u.backCompat(y,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var U=class extends y{constructor(){super(...arguments);this.children=[]}getChildren(t){if(!t)return this.children||[];let r=this.children||[];var i=[];return r.forEach(function(n){t(n)&&i.push(n)}),i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(t.length===0)return this;if(t.length>1){for(var r=0;r<t.length;r++)this.add(t[r]);return this}let i=t[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var r=this._generalFind(t,!0);return r.length>0?r[0]:void 0}_generalFind(t,r){var i=[];return this._descendants(n=>{let s=n._isMatch(t);return s&&i.push(n),!!(s&&r)}),i}_descendants(t){let r=!1,i=this.getChildren();for(let n of i){if(r=t(n),r)return!0;if(n.hasChildren()&&(r=n._descendants(t),r))return!0}return!1}toObject(){var t=y.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(r=>{t.children.push(r.toObject())}),t}isAncestorOf(t){for(var r=t.getParent();r;){if(r._id===this._id)return!0;r=r.getParent()}return!1}clone(t){var r=y.prototype.clone.call(this,t);return this.getChildren().forEach(function(i){r.add(i.clone())}),r}getAllIntersections(t){var r=[];return this.find("Shape").forEach(i=>{i.isVisible()&&i.intersects(t)&&r.push(i)}),r}_clearSelfAndDescendantCache(t){super._clearSelfAndDescendantCache(t),!this.isCached()&&this.children?.forEach(function(r){r._clearSelfAndDescendantCache(t)})}_setChildrenIndices(){this.children?.forEach(function(t,r){t.index=r}),this._requestDraw()}drawScene(t,r,i){var n=this.getLayer(),s=t||n&&n.getCanvas(),o=s&&s.getContext(),h=this._getCanvasCache(),l=h&&h.scene,d=s&&s.isCache;if(!this.isVisible()&&!d)return this;if(l){o.save();var f=this.getAbsoluteTransform(r).getMatrix();o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",s,r,i);return this}drawHit(t,r){if(!this.shouldDrawHit(r))return this;var i=this.getLayer(),n=t||i&&i.hitCanvas,s=n&&n.getContext(),o=this._getCanvasCache(),h=o&&o.hit;if(h){s.save();var l=this.getAbsoluteTransform(r).getMatrix();s.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",n,r);return this}_drawChildren(t,r,i,n){var s=r&&r.getContext(),o=this.clipWidth(),h=this.clipHeight(),l=this.clipFunc(),d=typeof o=="number"&&typeof h=="number"||l;let f=i===this;if(d){s.save();var c=this.getAbsoluteTransform(i),g=c.getMatrix();s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),s.beginPath();let S;if(l)S=l.call(this,s,this);else{var v=this.clipX(),p=this.clipY();s.rect(v||0,p||0,o,h)}s.clip.apply(s,S),g=c.copy().invert().getMatrix(),s.transform(g[0],g[1],g[2],g[3],g[4],g[5])}var b=!f&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";b&&(s.save(),s._applyGlobalCompositeOperation(this)),this.children?.forEach(function(S){S[t](r,i,n)}),b&&s.restore(),d&&s.restore()}getClientRect(t={}){var r=t.skipTransform,i=t.relativeTo,n,s,o,h,l={x:1/0,y:1/0,width:0,height:0},d=this;this.children?.forEach(function(p){if(p.visible()){var b=p.getClientRect({relativeTo:d,skipShadow:t.skipShadow,skipStroke:t.skipStroke});b.width===0&&b.height===0||(n===void 0?(n=b.x,s=b.y,o=b.x+b.width,h=b.y+b.height):(n=Math.min(n,b.x),s=Math.min(s,b.y),o=Math.max(o,b.x+b.width),h=Math.max(h,b.y+b.height)))}});for(var f=this.find("Shape"),c=!1,g=0;g<f.length;g++){var v=f[g];if(v._isVisible(this)){c=!0;break}}return c&&n!==void 0?l={x:n,y:s,width:o-n,height:h-s}:l={x:0,y:0,width:0,height:0},r?l:this._transformedRect(l,i)}};u.addComponentsGetterSetter(U,"clip",["x","y","width","height"]);u.addGetterSetter(U,"clipX",void 0,_());u.addGetterSetter(U,"clipY",void 0,_());u.addGetterSetter(U,"clipWidth",void 0,_());u.addGetterSetter(U,"clipHeight",void 0,_());u.addGetterSetter(U,"clipFunc");var Wt=new Map,er=G._global.PointerEvent!==void 0;function ae(a){return Wt.get(a)}function se(a){return{evt:a,pointerId:a.pointerId}}function oe(a,e){return Wt.get(a)===e}function he(a,e){At(a),e.getStage()&&(Wt.set(a,e),er&&e._fire("gotpointercapture",se(new PointerEvent("gotpointercapture"))))}function At(a,e){let t=Wt.get(a);if(!t)return;let r=t.getStage();r&&r.content,Wt.delete(a),er&&t._fire("lostpointercapture",se(new PointerEvent("lostpointercapture")))}var Hi="Stage",Vi="string",ir="px",zi="mouseout",ar="mouseleave",sr="mouseover",or="mouseenter",hr="mousemove",lr="mousedown",dr="mouseup",Yt="pointermove",Xt="pointerdown",Lt="pointerup",Ut="pointercancel",Wi="lostpointercapture",le="pointerout",de="pointerleave",ue="pointerover",fe="pointerenter",we="contextmenu",ur="touchstart",fr="touchend",cr="touchmove",gr="touchcancel",Ge="wheel",Yi=5,Xi=[[or,"_pointerenter"],[lr,"_pointerdown"],[hr,"_pointermove"],[dr,"_pointerup"],[ar,"_pointerleave"],[ur,"_pointerdown"],[cr,"_pointermove"],[fr,"_pointerup"],[gr,"_pointercancel"],[sr,"_pointerover"],[Ge,"_wheel"],[we,"_contextmenu"],[Xt,"_pointerdown"],[Yt,"_pointermove"],[Lt,"_pointerup"],[Ut,"_pointercancel"],[Wi,"_lostpointercapture"]],xe={mouse:{[le]:zi,[de]:ar,[ue]:sr,[fe]:or,[Yt]:hr,[Xt]:lr,[Lt]:dr,[Ut]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[le]:"touchout",[de]:"touchleave",[ue]:"touchover",[fe]:"touchenter",[Yt]:cr,[Xt]:ur,[Lt]:fr,[Ut]:gr,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[le]:le,[de]:de,[ue]:ue,[fe]:fe,[Yt]:Yt,[Xt]:Xt,[Lt]:Lt,[Ut]:Ut,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},qt=a=>a.indexOf("pointer")>=0?"pointer":a.indexOf("touch")>=0?"touch":"mouse",Nt=a=>{let e=qt(a);if(e==="pointer")return G.pointerEventsEnabled&&xe.pointer;if(e==="touch")return xe.touch;if(e==="mouse")return xe.mouse};function nr(a={}){return(a.clipFunc||a.clipWidth||a.clipHeight)&&m.warn("Stage does not support clipping. Please use clip for Layers or Groups."),a}var Ui="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);",Ot=[],Rt=class extends U{constructor(t){super(nr(t));this._pointerPositions=[];this._changedPointerPositions=[];this._buildDOM(),this._bindContentEvents(),Ot.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{nr(this.attrs)}),this._checkVisibility()}_validateAdd(t){let r=t.getType()==="Layer",i=t.getType()==="FastLayer";r||i||m.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;let t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if(typeof t===Vi){if(t.charAt(0)==="."){var r=t.slice(1);t=document.getElementsByClassName(r)[0]}else{var i;t.charAt(0)!=="#"?i=t:i=t.slice(1),t=document.getElementById(i)}if(!t)throw"Can not find container in document with id "+i}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var t=this.children,r=t.length,i;for(i=0;i<r;i++)t[i].clear();return this}clone(t){return t||(t={}),t.container=typeof document<"u"&&document.createElement("div"),U.prototype.clone.call(this,t)}destroy(){super.destroy();var t=this.content;t&&m._isInDocument(t)&&this.container().removeChild(t);var r=Ot.indexOf(this);return r>-1&&Ot.splice(r,1),m.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){let t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(m.warn(Ui),null)}_getPointerById(t){return this._pointerPositions.find(r=>r.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){t=t||{},t.x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();var r=new rt({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),i=r.getContext()._context,n=this.children;return(t.x||t.y)&&i.translate(-1*t.x,-1*t.y),n.forEach(function(s){if(s.isVisible()){var o=s._toKonvaCanvas(t);i.drawImage(o._canvas,t.x,t.y,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}}),r}getIntersection(t){if(!t)return null;var r=this.children,i=r.length,n=i-1,s;for(s=n;s>=0;s--){let o=r[s].getIntersection(t);if(o)return o}return null}_resizeDOM(){var t=this.width(),r=this.height();this.content&&(this.content.style.width=t+ir,this.content.style.height=r+ir),this.bufferCanvas.setSize(t,r),this.bufferHitCanvas.setSize(t,r),this.children.forEach(i=>{i.setSize({width:t,height:r}),i.draw()})}add(t,...r){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}super.add(t);var n=this.children.length;return n>Yi&&m.warn("The stage has "+n+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),G.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return oe(t,this)}setPointerCapture(t){he(t,this)}releaseCapture(t){At(t,this)}getLayers(){return this.children}_bindContentEvents(){G.isBrowser&&Xi.forEach(([t,r])=>{this.content.addEventListener(t,i=>{this[r](i)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);let r=Nt(t.type);r&&this._fire(r.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);let r=Nt(t.type);r&&this._fire(r.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let r=this[t+"targetShape"];return r&&!r.getStage()&&(r=null),r}_pointerleave(t){let r=Nt(t.type),i=qt(t.type);if(r){this.setPointersPositions(t);var n=this._getTargetShape(i),s=!(G.isDragging()||G.isTransforming())||G.hitOnDragEnabled;n&&s?(n._fireAndBubble(r.pointerout,{evt:t}),n._fireAndBubble(r.pointerleave,{evt:t}),this._fire(r.pointerleave,{evt:t,target:this,currentTarget:this}),this[i+"targetShape"]=null):s&&(this._fire(r.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(r.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}}_pointerdown(t){let r=Nt(t.type),i=qt(t.type);if(r){this.setPointersPositions(t);var n=!1;this._changedPointerPositions.forEach(s=>{var o=this.getIntersection(s);if(I.justDragged=!1,G["_"+i+"ListenClick"]=!0,!o||!o.isListening()){this[i+"ClickStartShape"]=void 0;return}G.capturePointerEventsEnabled&&o.setPointerCapture(s.id),this[i+"ClickStartShape"]=o,o._fireAndBubble(r.pointerdown,{evt:t,pointerId:s.id}),n=!0;let h=t.type.indexOf("touch")>=0;o.preventDefault()&&t.cancelable&&h&&t.preventDefault()}),n||this._fire(r.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(t){let r=Nt(t.type),i=qt(t.type);if(!r)return;G.isDragging()&&I.node.preventDefault()&&t.cancelable&&t.preventDefault(),this.setPointersPositions(t);var n=!(G.isDragging()||G.isTransforming())||G.hitOnDragEnabled;if(!n)return;var s={};let o=!1;var h=this._getTargetShape(i);this._changedPointerPositions.forEach(l=>{let d=ae(l.id)||this.getIntersection(l),f=l.id,c={evt:t,pointerId:f};var g=h!==d;if(g&&h&&(h._fireAndBubble(r.pointerout,{...c},d),h._fireAndBubble(r.pointerleave,{...c},d)),d){if(s[d._id])return;s[d._id]=!0}d&&d.isListening()?(o=!0,g&&(d._fireAndBubble(r.pointerover,{...c},h),d._fireAndBubble(r.pointerenter,{...c},h),this[i+"targetShape"]=d),d._fireAndBubble(r.pointermove,{...c})):h&&(this._fire(r.pointerover,{evt:t,target:this,currentTarget:this,pointerId:f}),this[i+"targetShape"]=null)}),o||this._fire(r.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){let r=Nt(t.type),i=qt(t.type);if(!r)return;this.setPointersPositions(t);let n=this[i+"ClickStartShape"],s=this[i+"ClickEndShape"];var o={};let h=!1;this._changedPointerPositions.forEach(l=>{let d=ae(l.id)||this.getIntersection(l);if(d){if(d.releaseCapture(l.id),o[d._id])return;o[d._id]=!0}let f=l.id,c={evt:t,pointerId:f},g=!1;G["_"+i+"InDblClickWindow"]?(g=!0,clearTimeout(this[i+"DblTimeout"])):I.justDragged||(G["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"])),this[i+"DblTimeout"]=setTimeout(function(){G["_"+i+"InDblClickWindow"]=!1},G.dblClickWindow),d&&d.isListening()?(h=!0,this[i+"ClickEndShape"]=d,d._fireAndBubble(r.pointerup,{...c}),G["_"+i+"ListenClick"]&&n&&n===d&&(d._fireAndBubble(r.pointerclick,{...c}),g&&s&&s===d&&d._fireAndBubble(r.pointerdblclick,{...c}))):(this[i+"ClickEndShape"]=null,G["_"+i+"ListenClick"]&&this._fire(r.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:f}),g&&this._fire(r.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:f}))}),h||this._fire(r.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),G["_"+i+"ListenClick"]=!1,t.cancelable&&i!=="touch"&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);var r=this.getIntersection(this.getPointerPosition());r&&r.isListening()?r._fireAndBubble(we,{evt:t}):this._fire(we,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);var r=this.getIntersection(this.getPointerPosition());r&&r.isListening()?r._fireAndBubble(Ge,{evt:t}):this._fire(Ge,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);let r=ae(t.pointerId)||this.getIntersection(this.getPointerPosition());r&&r._fireAndBubble(Lt,se(t)),At(t.pointerId)}_lostpointercapture(t){At(t.pointerId)}setPointersPositions(t){var r=this._getContentPosition(),i=null,n=null;t=t||window.event,t.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,s=>{this._pointerPositions.push({id:s.identifier,x:(s.clientX-r.left)/r.scaleX,y:(s.clientY-r.top)/r.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,s=>{this._changedPointerPositions.push({id:s.identifier,x:(s.clientX-r.left)/r.scaleX,y:(s.clientY-r.top)/r.scaleY})})):(i=(t.clientX-r.left)/r.scaleX,n=(t.clientY-r.top)/r.scaleY,this.pointerPos={x:i,y:n},this._pointerPositions=[{x:i,y:n,id:m._getFirstPointerId(t)}],this._changedPointerPositions=[{x:i,y:n,id:m._getFirstPointerId(t)}])}_setPointerPosition(t){m.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new rt({width:this.width(),height:this.height()}),this.bufferHitCanvas=new yt({pixelRatio:1,width:this.width(),height:this.height()}),!!G.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}}cache(){return m.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}};Rt.prototype.nodeType=Hi;L(Rt);u.addGetterSetter(Rt,"container");G.isBrowser&&document.addEventListener("visibilitychange",()=>{Ot.forEach(a=>{a.batchDraw()})});var mr="hasShadow",pr="shadowRGBA",br="patternImage",vr="linearGradient",Sr="radialGradient",ce;function Pe(){return ce||(ce=m.createCanvasElement().getContext("2d"),ce)}var kt={};function qi(a){let e=this.attrs.fillRule;e?a.fill(e):a.fill()}function Ki(a){a.stroke()}function ji(a){let e=this.attrs.fillRule;e?a.fill(e):a.fill()}function Ji(a){a.stroke()}function Qi(){this._clearCache(mr)}function Zi(){this._clearCache(pr)}function $i(){this._clearCache(br)}function tn(){this._clearCache(vr)}function en(){this._clearCache(Sr)}var C=class extends y{constructor(e){super(e);let t;for(;t=m.getRandomColor(),!(t&&!(t in kt)););this.colorKey=t,kt[t]=this}getContext(){return m.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return m.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(mr,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(br,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var e=Pe();let t=e.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){let r=new j;r.translate(this.fillPatternX(),this.fillPatternY()),r.rotate(G.getAngle(this.fillPatternRotation())),r.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),r.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());let i=r.getMatrix(),n=typeof DOMMatrix>"u"?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(n)}return t}}_getLinearGradient(){return this._getCache(vr,this.__getLinearGradient)}__getLinearGradient(){var e=this.fillLinearGradientColorStops();if(e){for(var t=Pe(),r=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),n=t.createLinearGradient(r.x,r.y,i.x,i.y),s=0;s<e.length;s+=2)n.addColorStop(e[s],e[s+1]);return n}}_getRadialGradient(){return this._getCache(Sr,this.__getRadialGradient)}__getRadialGradient(){var e=this.fillRadialGradientColorStops();if(e){for(var t=Pe(),r=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),n=t.createRadialGradient(r.x,r.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius()),s=0;s<e.length;s+=2)n.addColorStop(e[s],e[s+1]);return n}}getShadowRGBA(){return this._getCache(pr,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var e=m.colorToRGBA(this.shadowColor());if(e)return"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){let e=this.hitStrokeWidth();return e==="auto"?this.hasStroke():this.strokeEnabled()&&!!e}intersects(e){var t=this.getStage();if(!t)return!1;let r=t.bufferHitCanvas;return r.getContext().clear(),this.drawHit(r,void 0,!0),r.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0}destroy(){return y.prototype.destroy.call(this),delete kt[this.colorKey],delete this.colorKey,this}_useBufferCanvas(e){if(!(this.attrs.perfectDrawEnabled??!0))return!1;let r=e||this.hasFill(),i=this.hasStroke(),n=this.getAbsoluteOpacity()!==1;if(r&&i&&n)return!0;let s=this.hasShadow(),o=this.shadowForStrokeEnabled();return!!(r&&i&&s&&o)}setStrokeHitEnabled(e){m.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}getClientRect(e={}){let t=!1,r=this.getParent();for(;r;){if(r.isCached()){t=!0;break}r=r.getParent()}let i=e.skipTransform,n=e.relativeTo||t&&this.getStage()||void 0,s=this.getSelfRect(),h=!e.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,l=s.width+h,d=s.height+h,f=!e.skipShadow&&this.hasShadow(),c=f?this.shadowOffsetX():0,g=f?this.shadowOffsetY():0,v=l+Math.abs(c),p=d+Math.abs(g),b=f&&this.shadowBlur()||0,S=v+b*2,P=p+b*2,x={width:S,height:P,x:-(h/2+b)+Math.min(c,0)+s.x,y:-(h/2+b)+Math.min(g,0)+s.y};return i?x:this._transformedRect(x,n)}drawScene(e,t,r){var i=this.getLayer(),n=e||i.getCanvas(),s=n.getContext(),o=this._getCanvasCache(),h=this.getSceneFunc(),l=this.hasShadow(),d,f,c=n.isCache,g=t===this;if(!this.isVisible()&&!g)return this;if(o){s.save();var v=this.getAbsoluteTransform(t).getMatrix();return s.transform(v[0],v[1],v[2],v[3],v[4],v[5]),this._drawCachedSceneCanvas(s),s.restore(),this}if(!h)return this;if(s.save(),this._useBufferCanvas()&&!c){d=this.getStage();let S=r||d.bufferCanvas;f=S.getContext(),f.clear(),f.save(),f._applyLineJoin(this);var p=this.getAbsoluteTransform(t).getMatrix();f.transform(p[0],p[1],p[2],p[3],p[4],p[5]),h.call(this,f,this),f.restore();var b=S.pixelRatio;l&&s._applyShadow(this),s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(S._canvas,0,0,S.width/b,S.height/b)}else{if(s._applyLineJoin(this),!g){var p=this.getAbsoluteTransform(t).getMatrix();s.transform(p[0],p[1],p[2],p[3],p[4],p[5]),s._applyOpacity(this),s._applyGlobalCompositeOperation(this)}l&&s._applyShadow(this),h.call(this,s,this)}return s.restore(),this}drawHit(e,t,r=!1){if(!this.shouldDrawHit(t,r))return this;var i=this.getLayer(),n=e||i.hitCanvas,s=n&&n.getContext(),o=this.hitFunc()||this.sceneFunc(),h=this._getCanvasCache(),l=h&&h.hit;if(this.colorKey||m.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),l){s.save();var d=this.getAbsoluteTransform(t).getMatrix();return s.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._drawCachedHitCanvas(s),s.restore(),this}if(!o)return this;if(s.save(),s._applyLineJoin(this),!(this===t)){var c=this.getAbsoluteTransform(t).getMatrix();s.transform(c[0],c[1],c[2],c[3],c[4],c[5])}return o.call(this,s,this),s.restore(),this}drawHitFromCache(e=0){var t=this._getCanvasCache(),r=this._getCachedSceneCanvas(),i=t.hit,n=i.getContext(),s=i.getWidth(),o=i.getHeight(),h,l,d,f,c,g;n.clear(),n.drawImage(r._canvas,0,0,s,o);try{for(h=n.getImageData(0,0,s,o),l=h.data,d=l.length,f=m._hexToRgb(this.colorKey),c=0;c<d;c+=4)g=l[c+3],g>e?(l[c]=f.r,l[c+1]=f.g,l[c+2]=f.b,l[c+3]=255):l[c+3]=0;n.putImageData(h,0,0)}catch(v){m.error("Unable to draw hit graph from cached scene canvas. "+v.message)}return this}hasPointerCapture(e){return oe(e,this)}setPointerCapture(e){he(e,this)}releaseCapture(e){At(e,this)}};C.prototype._fillFunc=qi;C.prototype._strokeFunc=Ki;C.prototype._fillFuncHit=ji;C.prototype._strokeFuncHit=Ji;C.prototype._centroid=!1;C.prototype.nodeType="Shape";L(C);C.prototype.eventListeners={};C.prototype.on.call(C.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",Qi);C.prototype.on.call(C.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",Zi);C.prototype.on.call(C.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",$i);C.prototype.on.call(C.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",tn);C.prototype.on.call(C.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",en);u.addGetterSetter(C,"stroke",void 0,_e());u.addGetterSetter(C,"strokeWidth",2,_());u.addGetterSetter(C,"fillAfterStrokeEnabled",!1);u.addGetterSetter(C,"hitStrokeWidth","auto",Ht());u.addGetterSetter(C,"strokeHitEnabled",!0,J());u.addGetterSetter(C,"perfectDrawEnabled",!0,J());u.addGetterSetter(C,"shadowForStrokeEnabled",!0,J());u.addGetterSetter(C,"lineJoin");u.addGetterSetter(C,"lineCap");u.addGetterSetter(C,"sceneFunc");u.addGetterSetter(C,"hitFunc");u.addGetterSetter(C,"dash");u.addGetterSetter(C,"dashOffset",0,_());u.addGetterSetter(C,"shadowColor",void 0,ft());u.addGetterSetter(C,"shadowBlur",0,_());u.addGetterSetter(C,"shadowOpacity",1,_());u.addComponentsGetterSetter(C,"shadowOffset",["x","y"]);u.addGetterSetter(C,"shadowOffsetX",0,_());u.addGetterSetter(C,"shadowOffsetY",0,_());u.addGetterSetter(C,"fillPatternImage");u.addGetterSetter(C,"fill",void 0,_e());u.addGetterSetter(C,"fillPatternX",0,_());u.addGetterSetter(C,"fillPatternY",0,_());u.addGetterSetter(C,"fillLinearGradientColorStops");u.addGetterSetter(C,"strokeLinearGradientColorStops");u.addGetterSetter(C,"fillRadialGradientStartRadius",0);u.addGetterSetter(C,"fillRadialGradientEndRadius",0);u.addGetterSetter(C,"fillRadialGradientColorStops");u.addGetterSetter(C,"fillPatternRepeat","repeat");u.addGetterSetter(C,"fillEnabled",!0);u.addGetterSetter(C,"strokeEnabled",!0);u.addGetterSetter(C,"shadowEnabled",!0);u.addGetterSetter(C,"dashEnabled",!0);u.addGetterSetter(C,"strokeScaleEnabled",!0);u.addGetterSetter(C,"fillPriority","color");u.addComponentsGetterSetter(C,"fillPatternOffset",["x","y"]);u.addGetterSetter(C,"fillPatternOffsetX",0,_());u.addGetterSetter(C,"fillPatternOffsetY",0,_());u.addComponentsGetterSetter(C,"fillPatternScale",["x","y"]);u.addGetterSetter(C,"fillPatternScaleX",1,_());u.addGetterSetter(C,"fillPatternScaleY",1,_());u.addComponentsGetterSetter(C,"fillLinearGradientStartPoint",["x","y"]);u.addComponentsGetterSetter(C,"strokeLinearGradientStartPoint",["x","y"]);u.addGetterSetter(C,"fillLinearGradientStartPointX",0);u.addGetterSetter(C,"strokeLinearGradientStartPointX",0);u.addGetterSetter(C,"fillLinearGradientStartPointY",0);u.addGetterSetter(C,"strokeLinearGradientStartPointY",0);u.addComponentsGetterSetter(C,"fillLinearGradientEndPoint",["x","y"]);u.addComponentsGetterSetter(C,"strokeLinearGradientEndPoint",["x","y"]);u.addGetterSetter(C,"fillLinearGradientEndPointX",0);u.addGetterSetter(C,"strokeLinearGradientEndPointX",0);u.addGetterSetter(C,"fillLinearGradientEndPointY",0);u.addGetterSetter(C,"strokeLinearGradientEndPointY",0);u.addComponentsGetterSetter(C,"fillRadialGradientStartPoint",["x","y"]);u.addGetterSetter(C,"fillRadialGradientStartPointX",0);u.addGetterSetter(C,"fillRadialGradientStartPointY",0);u.addComponentsGetterSetter(C,"fillRadialGradientEndPoint",["x","y"]);u.addGetterSetter(C,"fillRadialGradientEndPointX",0);u.addGetterSetter(C,"fillRadialGradientEndPointY",0);u.addGetterSetter(C,"fillPatternRotation",0);u.addGetterSetter(C,"fillRule",void 0,ft());u.backCompat(C,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var rn="#",nn="beforeDraw",an="draw",_r=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],sn=_r.length,ot=class extends U{constructor(t){super(t);this.canvas=new rt;this.hitCanvas=new yt({pixelRatio:1});this._waitingForDraw=!1;this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var r=this.getStage();return r&&r.content&&(r.content.removeChild(this.getNativeCanvasElement()),t<r.children.length-1?r.content.insertBefore(this.getNativeCanvasElement(),r.children[t+1].getCanvas()._canvas):r.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){y.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var t=y.prototype.moveUp.call(this);if(!t)return!1;var r=this.getStage();return!r||!r.content?!1:(r.content.removeChild(this.getNativeCanvasElement()),this.index<r.children.length-1?r.content.insertBefore(this.getNativeCanvasElement(),r.children[this.index+1].getCanvas()._canvas):r.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(y.prototype.moveDown.call(this)){var t=this.getStage();if(t){var r=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),r[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(y.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var r=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),r[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return y.prototype.remove.call(this),t&&t.parentNode&&m._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:r}){return this.canvas.setSize(t,r),this.hitCanvas.setSize(t,r),this._setSmoothEnabled(),this}_validateAdd(t){var r=t.getType();r!=="Group"&&r!=="Shape"&&m.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),y.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){m.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){m.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,m.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var r=1,i=!1;;){for(let n=0;n<sn;n++){let s=_r[n],o=this._getIntersection({x:t.x+s.x*r,y:t.y+s.y*r}),h=o.shape;if(h)return h;if(i=!!o.antialiased,!o.antialiased)break}if(i)r+=1;else return null}}_getIntersection(t){let r=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*r),Math.round(t.y*r),1,1).data,n=i[3];if(n===255){let s=m._rgbToHex(i[0],i[1],i[2]),o=kt[rn+s];return o?{shape:o}:{antialiased:!0}}else if(n>0)return{antialiased:!0};return{}}drawScene(t,r){var i=this.getLayer(),n=t||i&&i.getCanvas();return this._fire(nn,{node:this}),this.clearBeforeDraw()&&n.getContext().clear(),U.prototype.drawScene.call(this,n,r),this._fire(an,{node:this}),this}drawHit(t,r){var i=this.getLayer(),n=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),U.prototype.drawHit.call(this,n,r),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){m.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return m.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var t=this.parent,r=!!this.hitCanvas._canvas.parentNode;r?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return m.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};ot.prototype.nodeType="Layer";L(ot);u.addGetterSetter(ot,"imageSmoothingEnabled",!0);u.addGetterSetter(ot,"clearBeforeDraw",!0);u.addGetterSetter(ot,"hitGraphEnabled",!0,J());var Ft=class extends ot{constructor(e){super(e),this.listening(!1),m.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};Ft.prototype.nodeType="FastLayer";L(Ft);var ht=class extends U{_validateAdd(e){var t=e.getType();t!=="Group"&&t!=="Shape"&&m.throw("You may only add groups and shapes to groups.")}};ht.prototype.nodeType="Group";L(ht);var Te=function(){return Gt.performance&&Gt.performance.now?function(){return Gt.performance.now()}:function(){return new Date().getTime()}}(),wt=class a{constructor(e,t){this.id=a.animIdCounter++;this.frame={time:0,timeDiff:0,lastTime:Te(),frameRate:0};this.func=e,this.setLayers(t)}setLayers(e){let t=[];return e&&(t=Array.isArray(e)?e:[e]),this.layers=t,this}getLayers(){return this.layers}addLayer(e){let t=this.layers,r=t.length;for(let i=0;i<r;i++)if(t[i]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){let t=a.animations,r=t.length;for(let i=0;i<r;i++)if(t[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Te(),a._addAnimation(this),this}stop(){return a._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static{this.animations=[]}static{this.animIdCounter=0}static{this.animRunning=!1}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){let t=e.id,r=this.animations,i=r.length;for(let n=0;n<i;n++)if(r[n].id===t){this.animations.splice(n,1);break}}static _runFrames(){let e={},t=this.animations;for(let r=0;r<t.length;r++){let i=t[r],n=i.layers,s=i.func;i._updateFrameObject(Te());let o=n.length,h;if(s?h=s.call(i,i.frame)!==!1:h=!0,!!h)for(let l=0;l<o;l++){let d=n[l];d._id!==void 0&&(e[d._id]=d)}}for(let r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){let e=a;e.animations.length?(e._runFrames(),m.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,m.requestAnimFrame(this._animationLoop))}};var on={node:1,duration:1,easing:1,onFinish:1,yoyo:1},hn=1,Cr=2,yr=3,ln=0,xr=["fill","stroke","shadowColor"],Ee=class{constructor(e,t,r,i,n,s,o){this.prop=e,this.propFunc=t,this.begin=i,this._pos=i,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=r,this._change=n-this.begin,this.pause()}fire(e){var t=this[e];t&&t()}setTime(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():e<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())}getTime(){return this._time}setPosition(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e}getPosition(e){return e===void 0&&(e=this._time),this.func(e,this.begin,this._change,this.duration)}play(){this.state=Cr,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=yr,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var e=this.getTimer()-this._startTime;this.state===Cr?this.setTime(e):this.state===yr&&this.setTime(this.duration-e)}pause(){this.state=hn,this.fire("onPause")}getTimer(){return new Date().getTime()}},Kt=class a{static{this.attrs={}}static{this.tweens={}}constructor(e){var t=this,r=e.node,i=r._id,n,s=e.easing||Dt.Linear,o=!!e.yoyo,h;typeof e.duration>"u"?n=.3:e.duration===0?n=.001:n=e.duration,this.node=r,this._id=ln++;var l=r.getLayer()||(r instanceof G.Stage?r.getLayers():null);l||m.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new wt(function(){t.tween.onEnterFrame()},l),this.tween=new Ee(h,function(d){t._tweenFunc(d)},s,0,1,n*1e3,o),this._addListeners(),a.attrs[i]||(a.attrs[i]={}),a.attrs[i][this._id]||(a.attrs[i][this._id]={}),a.tweens[i]||(a.tweens[i]={});for(h in e)on[h]===void 0&&this._addAttr(h,e[h]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset,this.onUpdate=e.onUpdate}_addAttr(e,t){var r=this.node,i=r._id,n,s,o,h,l,d,f,c;if(o=a.tweens[i][e],o&&delete a.attrs[i][o][e],n=r.getAttr(e),m._isArray(t))if(s=[],l=Math.max(t.length,n.length),e==="points"&&t.length!==n.length&&(t.length>n.length?(f=n,n=m._prepareArrayForTween(n,t,r.closed())):(d=t,t=m._prepareArrayForTween(t,n,r.closed()))),e.indexOf("fill")===0)for(h=0;h<l;h++)if(h%2===0)s.push(t[h]-n[h]);else{var g=m.colorToRGBA(n[h]);c=m.colorToRGBA(t[h]),n[h]=g,s.push({r:c.r-g.r,g:c.g-g.g,b:c.b-g.b,a:c.a-g.a})}else for(h=0;h<l;h++)s.push(t[h]-n[h]);else xr.indexOf(e)!==-1?(n=m.colorToRGBA(n),c=m.colorToRGBA(t),s={r:c.r-n.r,g:c.g-n.g,b:c.b-n.b,a:c.a-n.a}):s=t-n;a.attrs[i][this._id][e]={start:n,diff:s,end:t,trueEnd:d,trueStart:f},a.tweens[i][e]=this._id}_tweenFunc(e){var t=this.node,r=a.attrs[t._id][this._id],i,n,s,o,h,l,d,f;for(i in r){if(n=r[i],s=n.start,o=n.diff,f=n.end,m._isArray(s))if(h=[],d=Math.max(s.length,f.length),i.indexOf("fill")===0)for(l=0;l<d;l++)l%2===0?h.push((s[l]||0)+o[l]*e):h.push("rgba("+Math.round(s[l].r+o[l].r*e)+","+Math.round(s[l].g+o[l].g*e)+","+Math.round(s[l].b+o[l].b*e)+","+(s[l].a+o[l].a*e)+")");else for(l=0;l<d;l++)h.push((s[l]||0)+o[l]*e);else xr.indexOf(i)!==-1?h="rgba("+Math.round(s.r+o.r*e)+","+Math.round(s.g+o.g*e)+","+Math.round(s.b+o.b*e)+","+(s.a+o.a*e)+")":h=s+o*e;t.setAttr(i,h)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var e=this.node,t=a.attrs[e._id][this._id];t.points&&t.points.trueEnd&&e.setAttr("points",t.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var e=this.node,t=a.attrs[e._id][this._id];t.points&&t.points.trueStart&&e.points(t.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(e){return this.tween.seek(e*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var e=this.node._id,t=this._id,r=a.tweens[e],i;this.pause();for(i in r)delete a.tweens[e][i];delete a.attrs[e][t]}};y.prototype.to=function(a){var e=a.onFinish;a.node=this,a.onFinish=function(){this.destroy(),e&&e()};var t=new Kt(a);t.play()};var Dt={BackEaseIn(a,e,t,r){var i=1.70158;return t*(a/=r)*a*((i+1)*a-i)+e},BackEaseOut(a,e,t,r){var i=1.70158;return t*((a=a/r-1)*a*((i+1)*a+i)+1)+e},BackEaseInOut(a,e,t,r){var i=1.70158;return(a/=r/2)<1?t/2*(a*a*(((i*=1.525)+1)*a-i))+e:t/2*((a-=2)*a*(((i*=1.525)+1)*a+i)+2)+e},ElasticEaseIn(a,e,t,r,i,n){var s=0;return a===0?e:(a/=r)===1?e+t:(n||(n=r*.3),!i||i<Math.abs(t)?(i=t,s=n/4):s=n/(2*Math.PI)*Math.asin(t/i),-(i*Math.pow(2,10*(a-=1))*Math.sin((a*r-s)*(2*Math.PI)/n))+e)},ElasticEaseOut(a,e,t,r,i,n){var s=0;return a===0?e:(a/=r)===1?e+t:(n||(n=r*.3),!i||i<Math.abs(t)?(i=t,s=n/4):s=n/(2*Math.PI)*Math.asin(t/i),i*Math.pow(2,-10*a)*Math.sin((a*r-s)*(2*Math.PI)/n)+t+e)},ElasticEaseInOut(a,e,t,r,i,n){var s=0;return a===0?e:(a/=r/2)===2?e+t:(n||(n=r*(.3*1.5)),!i||i<Math.abs(t)?(i=t,s=n/4):s=n/(2*Math.PI)*Math.asin(t/i),a<1?-.5*(i*Math.pow(2,10*(a-=1))*Math.sin((a*r-s)*(2*Math.PI)/n))+e:i*Math.pow(2,-10*(a-=1))*Math.sin((a*r-s)*(2*Math.PI)/n)*.5+t+e)},BounceEaseOut(a,e,t,r){return(a/=r)<1/2.75?t*(7.5625*a*a)+e:a<2/2.75?t*(7.5625*(a-=1.5/2.75)*a+.75)+e:a<2.5/2.75?t*(7.5625*(a-=2.25/2.75)*a+.9375)+e:t*(7.5625*(a-=2.625/2.75)*a+.984375)+e},BounceEaseIn(a,e,t,r){return t-Dt.BounceEaseOut(r-a,0,t,r)+e},BounceEaseInOut(a,e,t,r){return a<r/2?Dt.BounceEaseIn(a*2,0,t,r)*.5+e:Dt.BounceEaseOut(a*2-r,0,t,r)*.5+t*.5+e},EaseIn(a,e,t,r){return t*(a/=r)*a+e},EaseOut(a,e,t,r){return-t*(a/=r)*(a-2)+e},EaseInOut(a,e,t,r){return(a/=r/2)<1?t/2*a*a+e:-t/2*(--a*(a-2)-1)+e},StrongEaseIn(a,e,t,r){return t*(a/=r)*a*a*a*a+e},StrongEaseOut(a,e,t,r){return t*((a=a/r-1)*a*a*a*a+1)+e},StrongEaseInOut(a,e,t,r){return(a/=r/2)<1?t/2*a*a*a*a*a+e:t/2*((a-=2)*a*a*a*a+2)+e},Linear(a,e,t,r){return t*a/r+e}};var Ae=m._assign(G,{Util:m,Transform:j,Node:y,Container:U,Stage:Rt,stages:Ot,Layer:ot,FastLayer:Ft,Group:ht,DD:I,Shape:C,shapes:kt,Animation:wt,Tween:Kt,Easings:Dt,Context:Pt,Canvas:Tt});var it=class extends C{_sceneFunc(e){var t=G.getAngle(this.angle()),r=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,t,r),e.arc(0,0,this.innerRadius(),t,0,!r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){let e=this.innerRadius(),t=this.outerRadius(),r=this.clockwise(),i=G.getAngle(r?360-this.angle():this.angle()),n=Math.cos(Math.min(i,Math.PI)),s=1,o=Math.sin(Math.min(Math.max(Math.PI,i),3*Math.PI/2)),h=Math.sin(Math.min(i,Math.PI/2)),l=n*(n>0?e:t),d=s*(s>0?t:e),f=o*(o>0?e:t),c=h*(h>0?t:e);return{x:l,y:r?-1*c:f,width:d-l,height:c-f}}};it.prototype._centroid=!0;it.prototype.className="Arc";it.prototype._attrsAffectingSize=["innerRadius","outerRadius"];L(it);u.addGetterSetter(it,"innerRadius",0,_());u.addGetterSetter(it,"outerRadius",0,_());u.addGetterSetter(it,"angle",0,_());u.addGetterSetter(it,"clockwise",!1,J());function Re(a,e,t,r,i,n,s){var o=Math.sqrt(Math.pow(t-a,2)+Math.pow(r-e,2)),h=Math.sqrt(Math.pow(i-t,2)+Math.pow(n-r,2)),l=s*o/(o+h),d=s*h/(o+h),f=t-l*(i-a),c=r-l*(n-e),g=t+d*(i-a),v=r+d*(n-e);return[f,c,g,v]}function wr(a,e){var t=a.length,r=[],i,n;for(i=2;i<t-2;i+=2)n=Re(a[i-2],a[i-1],a[i],a[i+1],a[i+2],a[i+3],e),!isNaN(n[0])&&(r.push(n[0]),r.push(n[1]),r.push(a[i]),r.push(a[i+1]),r.push(n[2]),r.push(n[3]));return r}var $=class extends C{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){var t=this.points(),r=t.length,i=this.tension(),n=this.closed(),s=this.bezier(),o,h,l;if(r){if(e.beginPath(),e.moveTo(t[0],t[1]),i!==0&&r>4){for(o=this.getTensionPoints(),h=o.length,l=n?0:4,n||e.quadraticCurveTo(o[0],o[1],o[2],o[3]);l<h-2;)e.bezierCurveTo(o[l++],o[l++],o[l++],o[l++],o[l++],o[l++]);n||e.quadraticCurveTo(o[h-2],o[h-1],t[r-2],t[r-1])}else if(s)for(l=2;l<r;)e.bezierCurveTo(t[l++],t[l++],t[l++],t[l++],t[l++],t[l++]);else for(l=2;l<r;l+=2)e.lineTo(t[l],t[l+1]);n?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():wr(this.points(),this.tension())}_getTensionPointsClosed(){var e=this.points(),t=e.length,r=this.tension(),i=Re(e[t-2],e[t-1],e[0],e[1],e[2],e[3],r),n=Re(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],r),s=wr(e,r),o=[i[2],i[3]].concat(s).concat([n[0],n[1],e[t-2],e[t-1],n[2],n[3],i[0],i[1],e[0],e[1]]);return o}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();for(var t=e[0],r=e[0],i=e[1],n=e[1],s,o,h=0;h<e.length/2;h++)s=e[h*2],o=e[h*2+1],t=Math.min(t,s),r=Math.max(r,s),i=Math.min(i,o),n=Math.max(n,o);return{x:t,y:i,width:r-t,height:n-i}}};$.prototype.className="Line";$.prototype._attrsAffectingSize=["points","bezier","tension"];L($);u.addGetterSetter($,"closed",!1);u.addGetterSetter($,"bezier",!1);u.addGetterSetter($,"tension",0,_());u.addGetterSetter($,"points",[],Xe());var dn=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],un=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],fn=[[1],[1,1],[1,2,1],[1,3,3,1]],Me=(a,e,t)=>{let r,i,n;r=t/2,i=0;for(let o=0;o<20;o++)n=r*dn[20][o]+r,i+=un[20][o]*cn(a,e,n);return r*i},Ne=(a,e,t)=>{t===void 0&&(t=1);let r=a[0]-2*a[1]+a[2],i=e[0]-2*e[1]+e[2],n=2*a[1]-2*a[0],s=2*e[1]-2*e[0],o=4*(r*r+i*i),h=4*(r*n+i*s),l=n*n+s*s;if(o===0)return t*Math.sqrt(Math.pow(a[2]-a[0],2)+Math.pow(e[2]-e[0],2));let d=h/(2*o),f=l/o,c=t+d,g=f-d*d,v=c*c+g>0?Math.sqrt(c*c+g):0,p=d*d+g>0?Math.sqrt(d*d+g):0,b=d+Math.sqrt(d*d+g)!==0?g*Math.log(Math.abs((c+v)/(d+p))):0;return Math.sqrt(o)/2*(c*v-d*p+b)};function cn(a,e,t){let r=ke(1,t,a),i=ke(1,t,e),n=r*r+i*i;return Math.sqrt(n)}var ke=(a,e,t)=>{let r=t.length-1,i,n;if(r===0)return 0;if(a===0){n=0;for(let s=0;s<=r;s++)n+=fn[r][s]*Math.pow(1-e,r-s)*Math.pow(e,s)*t[s];return n}else{i=new Array(r);for(let s=0;s<r;s++)i[s]=r*(t[s+1]-t[s]);return ke(a-1,e,i)}},Le=(a,e,t)=>{let r=1,i=a/e,n=(a-t(i))/e,s=0;for(;r>.001;){let o=t(i+n),h=Math.abs(a-o)/e;if(h<r)r=h,i+=n;else{let l=t(i-n),d=Math.abs(a-l)/e;d<r?(r=d,i-=n):n/=2}if(s++,s>500)break}return i};var Q=class a extends C{constructor(t){super(t);this.dataArray=[];this.pathLength=0;this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=a.parsePathData(this.data()),this.pathLength=a.getPathLength(this.dataArray)}_sceneFunc(t){var r=this.dataArray;t.beginPath();for(var i=!1,n=0;n<r.length;n++){var s=r[n].command,o=r[n].points;switch(s){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var h=o[0],l=o[1],d=o[2],f=o[3],c=o[4],g=o[5],v=o[6],p=o[7],b=d>f?d:f,S=d>f?1:d/f,P=d>f?f/d:1;t.translate(h,l),t.rotate(v),t.scale(S,P),t.arc(0,0,b,c,c+g,1-p),t.scale(1/S,1/P),t.rotate(-v),t.translate(-h,-l);break;case"z":i=!0,t.closePath();break}}!i&&!this.hasFill()?t.strokeShape(this):t.fillStrokeShape(this)}getSelfRect(){var t=[];this.dataArray.forEach(function(d){if(d.command==="A"){var f=d.points[4],c=d.points[5],g=d.points[4]+c,v=Math.PI/180;if(Math.abs(f-g)<v&&(v=Math.abs(f-g)),c<0)for(let p=f-v;p>g;p-=v){let b=a.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],p,0);t.push(b.x,b.y)}else for(let p=f+v;p<g;p+=v){let b=a.getPointOnEllipticalArc(d.points[0],d.points[1],d.points[2],d.points[3],p,0);t.push(b.x,b.y)}}else if(d.command==="C")for(let p=0;p<=1;p+=.01){let b=a.getPointOnCubicBezier(p,d.start.x,d.start.y,d.points[0],d.points[1],d.points[2],d.points[3],d.points[4],d.points[5]);t.push(b.x,b.y)}else t=t.concat(d.points)});for(var r=t[0],i=t[0],n=t[1],s=t[1],o,h,l=0;l<t.length/2;l++)o=t[l*2],h=t[l*2+1],isNaN(o)||(r=Math.min(r,o),i=Math.max(i,o)),isNaN(h)||(n=Math.min(n,h),s=Math.max(s,h));return{x:r,y:n,width:i-r,height:s-n}}getLength(){return this.pathLength}getPointAtLength(t){return a.getPointAtLengthOfDataArray(t,this.dataArray)}static getLineLength(t,r,i,n){return Math.sqrt((i-t)*(i-t)+(n-r)*(n-r))}static getPathLength(t){let r=0;for(var i=0;i<t.length;++i)r+=t[i].pathLength;return r}static getPointAtLengthOfDataArray(t,r){var i,n=0,s=r.length;if(!s)return null;for(;n<s&&t>r[n].pathLength;)t-=r[n].pathLength,++n;if(n===s)return i=r[n-1].points.slice(-2),{x:i[0],y:i[1]};if(t<.01)return i=r[n].points.slice(0,2),{x:i[0],y:i[1]};var o=r[n],h=o.points;switch(o.command){case"L":return a.getPointOnLine(t,o.start.x,o.start.y,h[0],h[1]);case"C":return a.getPointOnCubicBezier(Le(t,a.getPathLength(r),b=>Me([o.start.x,h[0],h[2],h[4]],[o.start.y,h[1],h[3],h[5]],b)),o.start.x,o.start.y,h[0],h[1],h[2],h[3],h[4],h[5]);case"Q":return a.getPointOnQuadraticBezier(Le(t,a.getPathLength(r),b=>Ne([o.start.x,h[0],h[2]],[o.start.y,h[1],h[3]],b)),o.start.x,o.start.y,h[0],h[1],h[2],h[3]);case"A":var l=h[0],d=h[1],f=h[2],c=h[3],g=h[4],v=h[5],p=h[6];return g+=v*t/o.pathLength,a.getPointOnEllipticalArc(l,d,f,c,g,p)}return null}static getPointOnLine(t,r,i,n,s,o,h){o=o??r,h=h??i;let l=this.getLineLength(r,i,n,s);if(l<1e-10)return{x:r,y:i};if(n===r)return{x:o,y:h+(s>i?t:-t)};let d=(s-i)/(n-r),f=Math.sqrt(t*t/(1+d*d))*(n<r?-1:1),c=d*f;if(Math.abs(h-i-d*(o-r))<1e-10)return{x:o+f,y:h+c};let g=((o-r)*(n-r)+(h-i)*(s-i))/(l*l),v=r+g*(n-r),p=i+g*(s-i),b=this.getLineLength(o,h,v,p),S=Math.sqrt(t*t-b*b),P=Math.sqrt(S*S/(1+d*d))*(n<r?-1:1),x=d*P;return{x:v+P,y:p+x}}static getPointOnCubicBezier(t,r,i,n,s,o,h,l,d){function f(S){return S*S*S}function c(S){return 3*S*S*(1-S)}function g(S){return 3*S*(1-S)*(1-S)}function v(S){return(1-S)*(1-S)*(1-S)}var p=l*f(t)+o*c(t)+n*g(t)+r*v(t),b=d*f(t)+h*c(t)+s*g(t)+i*v(t);return{x:p,y:b}}static getPointOnQuadraticBezier(t,r,i,n,s,o,h){function l(v){return v*v}function d(v){return 2*v*(1-v)}function f(v){return(1-v)*(1-v)}var c=o*l(t)+n*d(t)+r*f(t),g=h*l(t)+s*d(t)+i*f(t);return{x:c,y:g}}static getPointOnEllipticalArc(t,r,i,n,s,o){var h=Math.cos(o),l=Math.sin(o),d={x:i*Math.cos(s),y:n*Math.sin(s)};return{x:t+(d.x*h-d.y*l),y:r+(d.x*l+d.y*h)}}static parsePathData(t){if(!t)return[];var r=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];r=r.replace(new RegExp(" ","g"),",");for(var n=0;n<i.length;n++)r=r.replace(new RegExp(i[n],"g"),"|"+i[n]);var s=r.split("|"),o=[],h=[],l=0,d=0,f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,c;for(n=1;n<s.length;n++){var g=s[n],v=g.charAt(0);for(g=g.slice(1),h.length=0;c=f.exec(g);)h.push(c[0]);for(var p=[],b=0,S=h.length;b<S;b++){if(h[b]==="00"){p.push(0,0);continue}var P=parseFloat(h[b]);isNaN(P)?p.push(0):p.push(P)}for(;p.length>0&&!isNaN(p[0]);){var x="",w=[],T=l,E=d,k,N,R,M,A,O,X,W,Z,B;switch(v){case"l":l+=p.shift(),d+=p.shift(),x="L",w.push(l,d);break;case"L":l=p.shift(),d=p.shift(),w.push(l,d);break;case"m":var q=p.shift(),at=p.shift();if(l+=q,d+=at,x="M",o.length>2&&o[o.length-1].command==="z"){for(var st=o.length-2;st>=0;st--)if(o[st].command==="M"){l=o[st].points[0]+q,d=o[st].points[1]+at;break}}w.push(l,d),v="l";break;case"M":l=p.shift(),d=p.shift(),x="M",w.push(l,d),v="L";break;case"h":l+=p.shift(),x="L",w.push(l,d);break;case"H":l=p.shift(),x="L",w.push(l,d);break;case"v":d+=p.shift(),x="L",w.push(l,d);break;case"V":d=p.shift(),x="L",w.push(l,d);break;case"C":w.push(p.shift(),p.shift(),p.shift(),p.shift()),l=p.shift(),d=p.shift(),w.push(l,d);break;case"c":w.push(l+p.shift(),d+p.shift(),l+p.shift(),d+p.shift()),l+=p.shift(),d+=p.shift(),x="C",w.push(l,d);break;case"S":N=l,R=d,k=o[o.length-1],k.command==="C"&&(N=l+(l-k.points[2]),R=d+(d-k.points[3])),w.push(N,R,p.shift(),p.shift()),l=p.shift(),d=p.shift(),x="C",w.push(l,d);break;case"s":N=l,R=d,k=o[o.length-1],k.command==="C"&&(N=l+(l-k.points[2]),R=d+(d-k.points[3])),w.push(N,R,l+p.shift(),d+p.shift()),l+=p.shift(),d+=p.shift(),x="C",w.push(l,d);break;case"Q":w.push(p.shift(),p.shift()),l=p.shift(),d=p.shift(),w.push(l,d);break;case"q":w.push(l+p.shift(),d+p.shift()),l+=p.shift(),d+=p.shift(),x="Q",w.push(l,d);break;case"T":N=l,R=d,k=o[o.length-1],k.command==="Q"&&(N=l+(l-k.points[0]),R=d+(d-k.points[1])),l=p.shift(),d=p.shift(),x="Q",w.push(N,R,l,d);break;case"t":N=l,R=d,k=o[o.length-1],k.command==="Q"&&(N=l+(l-k.points[0]),R=d+(d-k.points[1])),l+=p.shift(),d+=p.shift(),x="Q",w.push(N,R,l,d);break;case"A":M=p.shift(),A=p.shift(),O=p.shift(),X=p.shift(),W=p.shift(),Z=l,B=d,l=p.shift(),d=p.shift(),x="A",w=this.convertEndpointToCenterParameterization(Z,B,l,d,X,W,M,A,O);break;case"a":M=p.shift(),A=p.shift(),O=p.shift(),X=p.shift(),W=p.shift(),Z=l,B=d,l+=p.shift(),d+=p.shift(),x="A",w=this.convertEndpointToCenterParameterization(Z,B,l,d,X,W,M,A,O);break}o.push({command:x||v,points:w,start:{x:T,y:E},pathLength:this.calcLength(T,E,x||v,w)})}(v==="z"||v==="Z")&&o.push({command:"z",points:[],start:void 0,pathLength:0})}return o}static calcLength(t,r,i,n){var s,o,h,l,d=a;switch(i){case"L":return d.getLineLength(t,r,n[0],n[1]);case"C":return Me([t,n[0],n[2],n[4]],[r,n[1],n[3],n[5]],1);case"Q":return Ne([t,n[0],n[2]],[r,n[1],n[3]],1);case"A":s=0;var f=n[4],c=n[5],g=n[4]+c,v=Math.PI/180;if(Math.abs(f-g)<v&&(v=Math.abs(f-g)),o=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],f,0),c<0)for(l=f-v;l>g;l-=v)h=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),s+=d.getLineLength(o.x,o.y,h.x,h.y),o=h;else for(l=f+v;l<g;l+=v)h=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],l,0),s+=d.getLineLength(o.x,o.y,h.x,h.y),o=h;return h=d.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),s+=d.getLineLength(o.x,o.y,h.x,h.y),s}return 0}static convertEndpointToCenterParameterization(t,r,i,n,s,o,h,l,d){var f=d*(Math.PI/180),c=Math.cos(f)*(t-i)/2+Math.sin(f)*(r-n)/2,g=-1*Math.sin(f)*(t-i)/2+Math.cos(f)*(r-n)/2,v=c*c/(h*h)+g*g/(l*l);v>1&&(h*=Math.sqrt(v),l*=Math.sqrt(v));var p=Math.sqrt((h*h*(l*l)-h*h*(g*g)-l*l*(c*c))/(h*h*(g*g)+l*l*(c*c)));s===o&&(p*=-1),isNaN(p)&&(p=0);var b=p*h*g/l,S=p*-l*c/h,P=(t+i)/2+Math.cos(f)*b-Math.sin(f)*S,x=(r+n)/2+Math.sin(f)*b+Math.cos(f)*S,w=function(A){return Math.sqrt(A[0]*A[0]+A[1]*A[1])},T=function(A,O){return(A[0]*O[0]+A[1]*O[1])/(w(A)*w(O))},E=function(A,O){return(A[0]*O[1]<A[1]*O[0]?-1:1)*Math.acos(T(A,O))},k=E([1,0],[(c-b)/h,(g-S)/l]),N=[(c-b)/h,(g-S)/l],R=[(-1*c-b)/h,(-1*g-S)/l],M=E(N,R);return T(N,R)<=-1&&(M=Math.PI),T(N,R)>=1&&(M=0),o===0&&M>0&&(M=M-2*Math.PI),o===1&&M<0&&(M=M+2*Math.PI),[P,x,h,l,k,M,f,o]}};Q.prototype.className="Path";Q.prototype._attrsAffectingSize=["data"];L(Q);u.addGetterSetter(Q,"data");var ct=class extends ${_sceneFunc(e){super._sceneFunc(e);var t=Math.PI*2,r=this.points(),i=r,n=this.tension()!==0&&r.length>4;n&&(i=this.getTensionPoints());var s=this.pointerLength(),o=r.length,h,l;if(n){let c=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[o-2],r[o-1]],g=Q.calcLength(i[i.length-4],i[i.length-3],"C",c),v=Q.getPointOnQuadraticBezier(Math.min(1,1-s/g),c[0],c[1],c[2],c[3],c[4],c[5]);h=r[o-2]-v.x,l=r[o-1]-v.y}else h=r[o-2]-r[o-4],l=r[o-1]-r[o-3];var d=(Math.atan2(l,h)+t)%t,f=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[o-2],r[o-1]),e.rotate(d),e.moveTo(0,0),e.lineTo(-s,f/2),e.lineTo(-s,-f/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),n?(h=(i[0]+i[2])/2-r[0],l=(i[1]+i[3])/2-r[1]):(h=r[2]-r[0],l=r[3]-r[1]),e.rotate((Math.atan2(-l,-h)+t)%t),e.moveTo(0,0),e.lineTo(-s,f/2),e.lineTo(-s,-f/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){var t=this.dashEnabled();t&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),t&&(this.attrs.dashEnabled=!0)}getSelfRect(){let e=super.getSelfRect(),t=this.pointerWidth()/2;return{x:e.x-t,y:e.y-t,width:e.width+t*2,height:e.height+t*2}}};ct.prototype.className="Arrow";L(ct);u.addGetterSetter(ct,"pointerLength",10,_());u.addGetterSetter(ct,"pointerWidth",10,_());u.addGetterSetter(ct,"pointerAtBeginning",!1);u.addGetterSetter(ct,"pointerAtEnding",!0);var vt=class extends C{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}};vt.prototype._centroid=!0;vt.prototype.className="Circle";vt.prototype._attrsAffectingSize=["radius"];L(vt);u.addGetterSetter(vt,"radius",0,_());var lt=class extends C{_sceneFunc(e){var t=this.radiusX(),r=this.radiusY();e.beginPath(),e.save(),t!==r&&e.scale(1,r/t),e.arc(0,0,t,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}};lt.prototype.className="Ellipse";lt.prototype._centroid=!0;lt.prototype._attrsAffectingSize=["radiusX","radiusY"];L(lt);u.addComponentsGetterSetter(lt,"radius",["x","y"]);u.addGetterSetter(lt,"radiusX",0,_());u.addGetterSetter(lt,"radiusY",0,_());var tt=class a extends C{constructor(e){super(e),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){let e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){let e=!!this.cornerRadius(),t=this.hasShadow();return e&&t?!0:super._useBufferCanvas(!0)}_sceneFunc(e){let t=this.getWidth(),r=this.getHeight(),i=this.cornerRadius(),n=this.attrs.image,s;if(n){let o=this.attrs.cropWidth,h=this.attrs.cropHeight;o&&h?s=[n,this.cropX(),this.cropY(),o,h,0,0,t,r]:s=[n,0,0,t,r]}(this.hasFill()||this.hasStroke()||i)&&(e.beginPath(),i?m.drawRoundedRectPath(e,t,r,i):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)),n&&(i&&e.clip(),e.drawImage.apply(e,s))}_hitFunc(e){var t=this.width(),r=this.height(),i=this.cornerRadius();e.beginPath(),i?m.drawRoundedRectPath(e,t,r,i):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.attrs.width??this.image()?.width}getHeight(){return this.attrs.height??this.image()?.height}static fromURL(e,t,r=null){var i=m.createImageElement();i.onload=function(){var n=new a({image:i});t(n)},i.onerror=r,i.crossOrigin="Anonymous",i.src=e}};tt.prototype.className="Image";L(tt);u.addGetterSetter(tt,"cornerRadius",0,Mt(4));u.addGetterSetter(tt,"image");u.addComponentsGetterSetter(tt,"crop",["x","y","width","height"]);u.addGetterSetter(tt,"cropX",0,_());u.addGetterSetter(tt,"cropY",0,_());u.addGetterSetter(tt,"cropWidth",0,_());u.addGetterSetter(tt,"cropHeight",0,_());var Gr=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],gn="Change.konva",mn="none",Oe="up",Fe="right",De="down",Ie="left",pn=Gr.length,It=class extends ht{constructor(e){super(e),this.on("add.konva",function(t){this._addListeners(t.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){var t=this,r,i=function(){t._sync()};for(r=0;r<pn;r++)e.on(Gr[r]+gn,i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var e=this.getText(),t=this.getTag(),r,i,n,s,o,h,l;if(e&&t){switch(r=e.width(),i=e.height(),n=t.pointerDirection(),s=t.pointerWidth(),l=t.pointerHeight(),o=0,h=0,n){case Oe:o=r/2,h=-1*l;break;case Fe:o=r+s,h=i/2;break;case De:o=r/2,h=i+l;break;case Ie:o=-1*s,h=i/2;break}t.setAttrs({x:-1*o,y:-1*h,width:r,height:i}),e.setAttrs({x:-1*o,y:-1*h})}}};It.prototype.className="Label";L(It);var gt=class extends C{_sceneFunc(e){var t=this.width(),r=this.height(),i=this.pointerDirection(),n=this.pointerWidth(),s=this.pointerHeight(),o=this.cornerRadius();let h=0,l=0,d=0,f=0;typeof o=="number"?h=l=d=f=Math.min(o,t/2,r/2):(h=Math.min(o[0]||0,t/2,r/2),l=Math.min(o[1]||0,t/2,r/2),f=Math.min(o[2]||0,t/2,r/2),d=Math.min(o[3]||0,t/2,r/2)),e.beginPath(),e.moveTo(h,0),i===Oe&&(e.lineTo((t-n)/2,0),e.lineTo(t/2,-1*s),e.lineTo((t+n)/2,0)),e.lineTo(t-l,0),e.arc(t-l,l,l,Math.PI*3/2,0,!1),i===Fe&&(e.lineTo(t,(r-s)/2),e.lineTo(t+n,r/2),e.lineTo(t,(r+s)/2)),e.lineTo(t,r-f),e.arc(t-f,r-f,f,0,Math.PI/2,!1),i===De&&(e.lineTo((t+n)/2,r),e.lineTo(t/2,r+s),e.lineTo((t-n)/2,r)),e.lineTo(d,r),e.arc(d,r-d,d,Math.PI/2,Math.PI,!1),i===Ie&&(e.lineTo(0,(r+s)/2),e.lineTo(-1*n,r/2),e.lineTo(0,(r-s)/2)),e.lineTo(0,h),e.arc(h,h,h,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){var e=0,t=0,r=this.pointerWidth(),i=this.pointerHeight(),n=this.pointerDirection(),s=this.width(),o=this.height();return n===Oe?(t-=i,o+=i):n===De?o+=i:n===Ie?(e-=r*1.5,s+=r):n===Fe&&(s+=r*1.5),{x:e,y:t,width:s,height:o}}};gt.prototype.className="Tag";L(gt);u.addGetterSetter(gt,"pointerDirection",mn);u.addGetterSetter(gt,"pointerWidth",0,_());u.addGetterSetter(gt,"pointerHeight",0,_());u.addGetterSetter(gt,"cornerRadius",0,Mt(4));var St=class extends C{_sceneFunc(e){var t=this.cornerRadius(),r=this.width(),i=this.height();e.beginPath(),t?m.drawRoundedRectPath(e,r,i,t):e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this)}};St.prototype.className="Rect";L(St);u.addGetterSetter(St,"cornerRadius",0,Mt(4));var mt=class extends C{_sceneFunc(e){let t=this._getPoints();e.beginPath(),e.moveTo(t[0].x,t[0].y);for(var r=1;r<t.length;r++)e.lineTo(t[r].x,t[r].y);e.closePath(),e.fillStrokeShape(this)}_getPoints(){let e=this.attrs.sides,t=this.attrs.radius||0,r=[];for(var i=0;i<e;i++)r.push({x:t*Math.sin(i*2*Math.PI/e),y:-1*t*Math.cos(i*2*Math.PI/e)});return r}getSelfRect(){let e=this._getPoints();var t=e[0].x,r=e[0].y,i=e[0].x,n=e[0].y;return e.forEach(s=>{t=Math.min(t,s.x),r=Math.max(r,s.x),i=Math.min(i,s.y),n=Math.max(n,s.y)}),{x:t,y:i,width:r-t,height:n-i}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}};mt.prototype.className="RegularPolygon";mt.prototype._centroid=!0;mt.prototype._attrsAffectingSize=["radius"];L(mt);u.addGetterSetter(mt,"radius",0,_());u.addGetterSetter(mt,"sides",0,_());var Pr=Math.PI*2,pt=class extends C{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,Pr,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),Pr,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}};pt.prototype.className="Ring";pt.prototype._centroid=!0;pt.prototype._attrsAffectingSize=["innerRadius","outerRadius"];L(pt);u.addGetterSetter(pt,"innerRadius",0,_());u.addGetterSetter(pt,"outerRadius",0,_());var et=class extends C{constructor(t){super(t);this._updated=!0;this.anim=new wt(()=>{var r=this._updated;return this._updated=!1,r}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(t){var r=this.animation(),i=this.frameIndex(),n=i*4,s=this.animations()[r],o=this.frameOffsets(),h=s[n+0],l=s[n+1],d=s[n+2],f=s[n+3],c=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,d,f),t.closePath(),t.fillStrokeShape(this)),c)if(o){var g=o[r],v=i*2;t.drawImage(c,h,l,d,f,g[v+0],g[v+1],d,f)}else t.drawImage(c,h,l,d,f,0,0,d,f)}_hitFunc(t){var r=this.animation(),i=this.frameIndex(),n=i*4,s=this.animations()[r],o=this.frameOffsets(),h=s[n+2],l=s[n+3];if(t.beginPath(),o){var d=o[r],f=i*2;t.rect(d[f+0],d[f+1],h,l)}else t.rect(0,0,h,l);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval(function(){t._updateIndex()},1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),r=this.animation(),i=this.animations(),n=i[r],s=n.length/4;t<s-1?this.frameIndex(t+1):this.frameIndex(0)}};et.prototype.className="Sprite";L(et);u.addGetterSetter(et,"animation");u.addGetterSetter(et,"animations");u.addGetterSetter(et,"frameOffsets");u.addGetterSetter(et,"image");u.addGetterSetter(et,"frameIndex",0,_());u.addGetterSetter(et,"frameRate",17,_());u.backCompat(et,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});var dt=class extends C{_sceneFunc(e){var t=this.innerRadius(),r=this.outerRadius(),i=this.numPoints();e.beginPath(),e.moveTo(0,0-r);for(var n=1;n<i*2;n++){var s=n%2===0?r:t,o=s*Math.sin(n*Math.PI/i),h=-1*s*Math.cos(n*Math.PI/i);e.lineTo(o,h)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}};dt.prototype.className="Star";dt.prototype._centroid=!0;dt.prototype._attrsAffectingSize=["innerRadius","outerRadius"];L(dt);u.addGetterSetter(dt,"numPoints",5,_());u.addGetterSetter(dt,"innerRadius",0,_());u.addGetterSetter(dt,"outerRadius",0,_());function Ve(a){return[...a].reduce((e,t,r,i)=>(/\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?(?:\u200D\p{Emoji_Presentation})+/u.test(t)?e.push(t):/\p{Regional_Indicator}{2}/u.test(t+(i[r+1]||""))?e.push(t+i[r+1]):r>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(t)?e[e.length-1]+=t:e.push(t),e),[])}var Bt="auto",bn="center",kr="inherit",jt="justify",vn="Change.konva",Sn="2d",Tr="-",Mr="left";var _n="text",Cn="Text",yn="top",xn="bottom",Er="middle",Nr="normal",wn="px ",ge=" ",Gn="right",Ar="rtl",Pn="word",Tn="char",Rr="none",Be="\u2026",Lr=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],En=Lr.length;function An(a){return a.split(",").map(e=>{e=e.trim();let t=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!r&&(e=`"${e}"`),e}).join(", ")}var me;function He(){return me||(me=m.createCanvasElement().getContext(Sn),me)}function Rn(a){a.fillText(this._partialText,this._partialTextX,this._partialTextY)}function kn(a){a.setAttr("miterLimit",2),a.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Mn(a){return a=a||{},!a.fillLinearGradientColorStops&&!a.fillRadialGradientColorStops&&!a.fillPatternImage&&(a.fill=a.fill||"black"),a}var H=class extends C{constructor(t){super(Mn(t));this._partialTextX=0;this._partialTextY=0;for(var r=0;r<En;r++)this.on(Lr[r]+vn,this._setTextData);this._setTextData()}_sceneFunc(t){var r=this.textArr,i=r.length;if(this.text()){var n=this.padding(),s=this.fontSize(),o=this.lineHeight()*s,h=this.verticalAlign(),l=this.direction(),d=0,f=this.align(),c=this.getWidth(),g=this.letterSpacing(),v=this.fill(),p=this.textDecoration(),b=p.indexOf("underline")!==-1,S=p.indexOf("line-through")!==-1,P;l=l===kr?t.direction:l;var x=o/2,w=Er;if(G._fixTextRendering){var T=this.measureSize("M");w="alphabetic",x=(T.fontBoundingBoxAscent-T.fontBoundingBoxDescent)/2+o/2}var E=0,k=0;for(l===Ar&&t.setAttr("direction",l),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",w),t.setAttr("textAlign",Mr),h===Er?d=(this.getHeight()-i*o-n*2)/2:h===xn&&(d=this.getHeight()-i*o-n*2),t.translate(n,d+n),P=0;P<i;P++){var E=0,k=0,N=r[P],R=N.text,M=N.width,A=N.lastInParagraph,O,X,W;if(t.save(),f===Gn?E+=c-M-n*2:f===bn&&(E+=(c-M-n*2)/2),b){t.save(),t.beginPath();let D=G._fixTextRendering?Math.round(s/4):Math.round(s/2),V=E,K=x+k+D;t.moveTo(V,K),O=R.split(" ").length-1,X=O===0,W=f===jt&&!A?c-n*2:M,t.lineTo(V+Math.round(W),K),t.lineWidth=s/15;let ut=this._getLinearGradient();t.strokeStyle=ut||v,t.stroke(),t.restore()}if(S){t.save(),t.beginPath();let D=G._fixTextRendering?-Math.round(s/4):0;t.moveTo(E,x+k+D),O=R.split(" ").length-1,X=O===0,W=f===jt&&A&&!X?c-n*2:M,t.lineTo(E+Math.round(W),x+k+D),t.lineWidth=s/15;let V=this._getLinearGradient();t.strokeStyle=V||v,t.stroke(),t.restore()}if(l!==Ar&&(g!==0||f===jt)){O=R.split(" ").length-1;for(var Z=Ve(R),B=0;B<Z.length;B++){var q=Z[B];q===" "&&!A&&f===jt&&(E+=(c-n*2-M)/O),this._partialTextX=E,this._partialTextY=x+k,this._partialText=q,t.fillStrokeShape(this),E+=this.measureSize(q).width+g}}else g!==0&&t.setAttr("letterSpacing",`${g}px`),this._partialTextX=E,this._partialTextY=x+k,this._partialText=R,t.fillStrokeShape(this);t.restore(),i>1&&(x+=o)}}}_hitFunc(t){var r=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,r,i),t.closePath(),t.fillStrokeShape(this)}setText(t){var r=m._isString(t)?t:t==null?"":t+"";return this._setAttr(_n,r),this}getWidth(){var t=this.attrs.width===Bt||this.attrs.width===void 0;return t?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var t=this.attrs.height===Bt||this.attrs.height===void 0;return t?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return m.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var r=He(),i=this.fontSize(),n;r.save(),r.font=this._getContextFont(),n=r.measureText(t),r.restore();let s=i/100;return{actualBoundingBoxAscent:n.actualBoundingBoxAscent??71.58203125*s,actualBoundingBoxDescent:n.actualBoundingBoxDescent??0,actualBoundingBoxLeft:n.actualBoundingBoxLeft??-7.421875*s,actualBoundingBoxRight:n.actualBoundingBoxRight??75.732421875*s,alphabeticBaseline:n.alphabeticBaseline??0,emHeightAscent:n.emHeightAscent??100*s,emHeightDescent:n.emHeightDescent??-20*s,fontBoundingBoxAscent:n.fontBoundingBoxAscent??91*s,fontBoundingBoxDescent:n.fontBoundingBoxDescent??21*s,hangingBaseline:n.hangingBaseline??72.80000305175781*s,ideographicBaseline:n.ideographicBaseline??-21*s,width:n.width,height:i}}_getContextFont(){return this.fontStyle()+ge+this.fontVariant()+ge+(this.fontSize()+wn)+An(this.fontFamily())}_addTextLine(t){this.align()===jt&&(t=t.trim());var i=this._getTextWidth(t);return this.textArr.push({text:t,width:i,lastInParagraph:!1})}_getTextWidth(t){var r=this.letterSpacing(),i=t.length;return He().measureText(t).width+(i?r*(i-1):0)}_setTextData(){var t=this.text().split(`
`),r=+this.fontSize(),i=0,n=this.lineHeight()*r,s=this.attrs.width,o=this.attrs.height,h=s!==Bt&&s!==void 0,l=o!==Bt&&o!==void 0,d=this.padding(),f=s-d*2,c=o-d*2,g=0,v=this.wrap(),p=v!==Rr,b=v!==Tn&&p,S=this.ellipsis();this.textArr=[],He().font=this._getContextFont();for(var P=S?this._getTextWidth(Be):0,x=0,w=t.length;x<w;++x){var T=t[x],E=this._getTextWidth(T);if(h&&E>f)for(;T.length>0;){for(var k=0,N=T.length,R="",M=0;k<N;){var A=k+N>>>1,O=T.slice(0,A+1),X=this._getTextWidth(O)+P;X<=f?(k=A+1,R=O,M=X):N=A}if(R){if(b){var W,Z=T[R.length],B=Z===ge||Z===Tr;B&&M<=f?W=R.length:W=Math.max(R.lastIndexOf(ge),R.lastIndexOf(Tr))+1,W>0&&(k=W,R=R.slice(0,k),M=this._getTextWidth(R))}R=R.trimRight(),this._addTextLine(R),i=Math.max(i,M),g+=n;var q=this._shouldHandleEllipsis(g);if(q){this._tryToAddEllipsisToLastLine();break}if(T=T.slice(k),T=T.trimLeft(),T.length>0&&(E=this._getTextWidth(T),E<=f)){this._addTextLine(T),g+=n,i=Math.max(i,E);break}}else break}else this._addTextLine(T),g+=n,i=Math.max(i,E),this._shouldHandleEllipsis(g)&&x<w-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&g+n>c)break}this.textHeight=r,this.textWidth=i}_shouldHandleEllipsis(t){var r=+this.fontSize(),i=this.lineHeight()*r,n=this.attrs.height,s=n!==Bt&&n!==void 0,o=this.padding(),h=n-o*2,l=this.wrap(),d=l!==Rr;return!d||s&&t+i>h}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,r=t!==Bt&&t!==void 0,i=this.padding(),n=t-i*2,s=this.ellipsis(),o=this.textArr[this.textArr.length-1];if(!(!o||!s)){if(r){var h=this._getTextWidth(o.text+Be)<n;h||(o.text=o.text.slice(0,o.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(o.text+Be)}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){let t=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,r=this.hasShadow();return t&&r?!0:super._useBufferCanvas()}};H.prototype._fillFunc=Rn;H.prototype._strokeFunc=kn;H.prototype.className=Cn;H.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];L(H);u.overWriteSetter(H,"width",Ht());u.overWriteSetter(H,"height",Ht());u.addGetterSetter(H,"direction",kr);u.addGetterSetter(H,"fontFamily","Arial");u.addGetterSetter(H,"fontSize",12,_());u.addGetterSetter(H,"fontStyle",Nr);u.addGetterSetter(H,"fontVariant",Nr);u.addGetterSetter(H,"padding",0,_());u.addGetterSetter(H,"align",Mr);u.addGetterSetter(H,"verticalAlign",yn);u.addGetterSetter(H,"lineHeight",1,_());u.addGetterSetter(H,"wrap",Pn);u.addGetterSetter(H,"ellipsis",!1,J());u.addGetterSetter(H,"letterSpacing",0,_());u.addGetterSetter(H,"text","",ft());u.addGetterSetter(H,"textDecoration","");var Nn="",Or="normal";function Fr(a){a.fillText(this.partialText,0,0)}function Dr(a){a.strokeText(this.partialText,0,0)}var Y=class extends C{constructor(t){super(t);this.dummyCanvas=m.createCanvasElement();this.dataArray=[];this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Q.getPathLength(this.dataArray)}_getPointAtLength(t){if(!this.attrs.data)return null;let r=this.pathLength;return t-1>r?null:Q.getPointAtLengthOfDataArray(t,this.dataArray)}_readDataAttribute(){this.dataArray=Q.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var r=this.textDecoration(),i=this.fill(),n=this.fontSize(),s=this.glyphInfo;r==="underline"&&t.beginPath();for(var o=0;o<s.length;o++){t.save();var h=s[o].p0;t.translate(h.x,h.y),t.rotate(s[o].rotation),this.partialText=s[o].text,t.fillStrokeShape(this),r==="underline"&&(o===0&&t.moveTo(0,n/2+1),t.lineTo(n,n/2+1)),t.restore()}r==="underline"&&(t.strokeStyle=i,t.lineWidth=n/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();var r=this.glyphInfo;if(r.length>=1){var i=r[0].p0;t.moveTo(i.x,i.y)}for(var n=0;n<r.length;n++){var s=r[n].p1;t.lineTo(s.x,s.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return m.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return H.prototype.setText.call(this,t)}_getContextFont(){return H.prototype._getContextFont.call(this)}_getTextSize(t){var r=this.dummyCanvas,i=r.getContext("2d");i.save(),i.font=this._getContextFont();var n=i.measureText(t);return i.restore(),{width:n.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){let{width:t,height:r}=this._getTextSize(this.attrs.text);if(this.textWidth=t,this.textHeight=r,this.glyphInfo=[],!this.attrs.data)return null;let i=this.letterSpacing(),n=this.align(),s=this.kerningFunc(),o=Math.max(this.textWidth+((this.attrs.text||"").length-1)*i,0),h=0;n==="center"&&(h=Math.max(0,this.pathLength/2-o/2)),n==="right"&&(h=Math.max(0,this.pathLength-o));let l=Ve(this.text()),d=h;for(var f=0;f<l.length;f++){let c=this._getPointAtLength(d);if(!c)return;let g=this._getTextSize(l[f]).width+i;if(l[f]===" "&&n==="justify"){let x=this.text().split(" ").length-1;g+=(this.pathLength-o)/x}let v=this._getPointAtLength(d+g);if(!v)return;let p=Q.getLineLength(c.x,c.y,v.x,v.y),b=0;if(s)try{b=s(l[f-1],l[f])*this.fontSize()}catch{b=0}c.x+=b,v.x+=b,this.textWidth+=b;let S=Q.getPointOnLine(b+p/2,c.x,c.y,v.x,v.y),P=Math.atan2(v.y-c.y,v.x-c.x);this.glyphInfo.push({transposeX:S.x,transposeY:S.y,text:l[f],rotation:P,p0:c,p1:v}),d+=g}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach(function(f){t.push(f.p0.x),t.push(f.p0.y),t.push(f.p1.x),t.push(f.p1.y)});for(var r=t[0]||0,i=t[0]||0,n=t[1]||0,s=t[1]||0,o,h,l=0;l<t.length/2;l++)o=t[l*2],h=t[l*2+1],r=Math.min(r,o),i=Math.max(i,o),n=Math.min(n,h),s=Math.max(s,h);var d=this.fontSize();return{x:r-d/2,y:n-d/2,width:i-r+d,height:s-n+d}}destroy(){return m.releaseCanvas(this.dummyCanvas),super.destroy()}};Y.prototype._fillFunc=Fr;Y.prototype._strokeFunc=Dr;Y.prototype._fillFuncHit=Fr;Y.prototype._strokeFuncHit=Dr;Y.prototype.className="TextPath";Y.prototype._attrsAffectingSize=["text","fontSize","data"];L(Y);u.addGetterSetter(Y,"data");u.addGetterSetter(Y,"fontFamily","Arial");u.addGetterSetter(Y,"fontSize",12,_());u.addGetterSetter(Y,"fontStyle",Or);u.addGetterSetter(Y,"align","left");u.addGetterSetter(Y,"letterSpacing",0,_());u.addGetterSetter(Y,"textBaseline","middle");u.addGetterSetter(Y,"fontVariant",Or);u.addGetterSetter(Y,"text",Nn);u.addGetterSetter(Y,"textDecoration",null);u.addGetterSetter(Y,"kerningFunc",null);var Hr="tr-konva",Ln=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(a=>a+`.${Hr}`).join(" "),Ir="nodesRect",On=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],Fn={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Dn="ontouchstart"in G._global;function In(a,e,t){if(a==="rotater")return t;e+=m.degToRad(Fn[a]||0);var r=(m.radToDeg(e)%360+360)%360;return m._inRange(r,315+22.5,360)||m._inRange(r,0,22.5)?"ns-resize":m._inRange(r,45-22.5,45+22.5)?"nesw-resize":m._inRange(r,90-22.5,90+22.5)?"ew-resize":m._inRange(r,135-22.5,135+22.5)?"nwse-resize":m._inRange(r,180-22.5,180+22.5)?"ns-resize":m._inRange(r,225-22.5,225+22.5)?"nesw-resize":m._inRange(r,270-22.5,270+22.5)?"ew-resize":m._inRange(r,315-22.5,315+22.5)?"nwse-resize":(m.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}var pe=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],Br=1e8;function Bn(a){return{x:a.x+a.width/2*Math.cos(a.rotation)+a.height/2*Math.sin(-a.rotation),y:a.y+a.height/2*Math.cos(a.rotation)+a.width/2*Math.sin(a.rotation)}}function Vr(a,e,t){let r=t.x+(a.x-t.x)*Math.cos(e)-(a.y-t.y)*Math.sin(e),i=t.y+(a.x-t.x)*Math.sin(e)+(a.y-t.y)*Math.cos(e);return{...a,rotation:a.rotation+e,x:r,y:i}}function Hn(a,e){let t=Bn(a);return Vr(a,e,t)}function Vn(a,e,t){let r=e;for(let i=0;i<a.length;i++){let n=G.getAngle(a[i]),s=Math.abs(n-e)%(Math.PI*2);Math.min(s,Math.PI*2-s)<t&&(r=n)}return r}var ze=0,F=class extends ht{constructor(t){super(t);this._movingAnchorName=null;this._transforming=!1;this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(Ln,this.update),this.getNode()&&this.update()}static{this.isTransforming=()=>ze>0}attachTo(t){return this.setNode(t),this}setNode(t){return m.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return Hr+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach();let r=t.filter(n=>n.isAncestorOf(this)?(m.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);this._nodes=t=r,t.length===1&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(n=>{let s=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},o=n._attrsAffectingSize.map(h=>h+"Change."+this._getEventNamespace()).join(" ");n.on(o,s),n.on(On.map(h=>h+`.${this._getEventNamespace()}`).join(" "),s),n.on(`absoluteTransformChange.${this._getEventNamespace()}`,s),this._proxyDrag(n)}),this._resetTransformCache();var i=!!this.findOne(".top-left");return i&&this.update(),this}_proxyDrag(t){let r;t.on(`dragstart.${this._getEventNamespace()}`,i=>{r=t.getAbsolutePosition(),!this.isDragging()&&t!==this.findOne(".back")&&this.startDrag(i,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,i=>{if(!r)return;let n=t.getAbsolutePosition(),s=n.x-r.x,o=n.y-r.y;this.nodes().forEach(h=>{if(h===t||h.isDragging())return;let l=h.getAbsolutePosition();h.setAbsolutePosition({x:l.x+s,y:l.y+o}),h.startDrag(i)}),r=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(Ir),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(Ir,this.__getNodeRect)}__getNodeShape(t,r=this.rotation(),i){var n=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=t.getAbsoluteScale(i),o=t.getAbsolutePosition(i),h=n.x*s.x-t.offsetX()*s.x,l=n.y*s.y-t.offsetY()*s.y;let d=(G.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),f={x:o.x+h*Math.cos(d)+l*Math.sin(-d),y:o.y+l*Math.cos(d)+h*Math.sin(d),width:n.width*s.x,height:n.height*s.y,rotation:d};return Vr(f,-G.getAngle(r),{x:0,y:0})}__getNodeRect(){var t=this.getNode();if(!t)return{x:-Br,y:-Br,width:0,height:0,rotation:0};let r=[];this.nodes().map(d=>{let f=d.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var c=[{x:f.x,y:f.y},{x:f.x+f.width,y:f.y},{x:f.x+f.width,y:f.y+f.height},{x:f.x,y:f.y+f.height}],g=d.getAbsoluteTransform();c.forEach(function(v){var p=g.point(v);r.push(p)})});let i=new j;i.rotate(-G.getAngle(this.rotation()));var n=1/0,s=1/0,o=-1/0,h=-1/0;r.forEach(function(d){var f=i.point(d);n===void 0&&(n=o=f.x,s=h=f.y),n=Math.min(n,f.x),s=Math.min(s,f.y),o=Math.max(o,f.x),h=Math.max(h,f.y)}),i.invert();let l=i.point({x:n,y:s});return{x:l.x,y:l.y,width:o-n,height:h-s,rotation:G.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),pe.forEach(t=>{this._createAnchor(t)}),this._createAnchor("rotater")}_createAnchor(t){var r=new St({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Dn?10:"auto"}),i=this;r.on("mousedown touchstart",function(n){i._handleMouseDown(n)}),r.on("dragstart",n=>{r.stopDrag(),n.cancelBubble=!0}),r.on("dragend",n=>{n.cancelBubble=!0}),r.on("mouseenter",()=>{var n=G.getAngle(this.rotation()),s=this.rotateAnchorCursor(),o=In(t,n,s);r.getStage().content&&(r.getStage().content.style.cursor=o),this._cursorChange=!0}),r.on("mouseout",()=>{r.getStage().content&&(r.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(r)}_createBack(){var t=new C({name:"back",width:0,height:0,draggable:!0,sceneFunc(r,i){var n=i.getParent(),s=n.padding();r.beginPath(),r.rect(-s,-s,i.width()+s*2,i.height()+s*2),r.moveTo(i.width()/2,-s),n.rotateEnabled()&&n.rotateLineVisible()&&r.lineTo(i.width()/2,-n.rotateAnchorOffset()*m._sign(i.height())-s),r.fillStrokeShape(i)},hitFunc:(r,i)=>{if(this.shouldOverdrawWholeArea()){var n=this.padding();r.beginPath(),r.rect(-n,-n,i.width()+n*2,i.height()+n*2),r.fillStrokeShape(i)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",r=>{r.cancelBubble=!0}),t.on("dragmove",r=>{r.cancelBubble=!0}),t.on("dragend",r=>{r.cancelBubble=!0}),this.on("dragmove",r=>{this.update()})}_handleMouseDown(t){if(!this._transforming){this._movingAnchorName=t.target.name().split(" ")[0];var r=this._getNodeRect(),i=r.width,n=r.height,s=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.sin=Math.abs(n/s),this.cos=Math.abs(i/s),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var o=t.target.getAbsolutePosition(),h=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:h.x-o.x,y:h.y-o.y},ze++,this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(l=>{l._fire("transformstart",{evt:t.evt,target:l})})}}_handleMouseMove(t){var r,i,n,s=this.findOne("."+this._movingAnchorName),o=s.getStage();o.setPointersPositions(t);let h=o.getPointerPosition(),l={x:h.x-this._anchorDragOffset.x,y:h.y-this._anchorDragOffset.y},d=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(d,l,t)),s.setAbsolutePosition(l);let f=s.getAbsolutePosition();if(!(d.x===f.x&&d.y===f.y)){if(this._movingAnchorName==="rotater"){var c=this._getNodeRect();r=s.x()-c.width/2,i=-s.y()+c.height/2;let W=Math.atan2(-i,r)+Math.PI/2;c.height<0&&(W-=Math.PI);var g=G.getAngle(this.rotation());let Z=g+W,B=G.getAngle(this.rotationSnapTolerance()),at=Vn(this.rotationSnaps(),Z,B)-c.rotation,st=Hn(c,at);this._fitNodesInto(st,t);return}var v=this.shiftBehavior(),p;v==="inverted"?p=this.keepRatio()&&!t.shiftKey:v==="none"?p=this.keepRatio():p=this.keepRatio()||t.shiftKey;var w=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(p){var b=w?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};n=Math.sqrt(Math.pow(b.x-s.x(),2)+Math.pow(b.y-s.y(),2));var S=this.findOne(".top-left").x()>b.x?-1:1,P=this.findOne(".top-left").y()>b.y?-1:1;r=n*this.cos*S,i=n*this.sin*P,this.findOne(".top-left").x(b.x-r),this.findOne(".top-left").y(b.y-i)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(s.y());else if(this._movingAnchorName==="top-right"){if(p){var b=w?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};n=Math.sqrt(Math.pow(s.x()-b.x,2)+Math.pow(b.y-s.y(),2));var S=this.findOne(".top-right").x()<b.x?-1:1,P=this.findOne(".top-right").y()>b.y?-1:1;r=n*this.cos*S,i=n*this.sin*P,this.findOne(".top-right").x(b.x+r),this.findOne(".top-right").y(b.y-i)}var x=s.position();this.findOne(".top-left").y(x.y),this.findOne(".bottom-right").x(x.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(s.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(s.x());else if(this._movingAnchorName==="bottom-left"){if(p){var b=w?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};n=Math.sqrt(Math.pow(b.x-s.x(),2)+Math.pow(s.y()-b.y,2));var S=b.x<s.x()?-1:1,P=s.y()<b.y?-1:1;r=n*this.cos*S,i=n*this.sin*P,s.x(b.x-r),s.y(b.y+i)}x=s.position(),this.findOne(".top-left").x(x.x),this.findOne(".bottom-right").y(x.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(s.y());else if(this._movingAnchorName==="bottom-right"){if(p){var b=w?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};n=Math.sqrt(Math.pow(s.x()-b.x,2)+Math.pow(s.y()-b.y,2));var S=this.findOne(".bottom-right").x()<b.x?-1:1,P=this.findOne(".bottom-right").y()<b.y?-1:1;r=n*this.cos*S,i=n*this.sin*P,this.findOne(".bottom-right").x(b.x+r),this.findOne(".bottom-right").y(b.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var w=this.centeredScaling()||t.altKey;if(w){var T=this.findOne(".top-left"),E=this.findOne(".bottom-right"),k=T.x(),N=T.y(),R=this.getWidth()-E.x(),M=this.getHeight()-E.y();E.move({x:-k,y:-N}),T.move({x:R,y:M})}var A=this.findOne(".top-left").getAbsolutePosition();r=A.x,i=A.y;var O=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),X=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:r,y:i,width:O,height:X,rotation:G.getAngle(this.rotation())},t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var r=this.getNode();ze--,this._fire("transformend",{evt:t,target:r}),this.getLayer()?.batchDraw(),r&&this._nodes.forEach(i=>{i._fire("transformend",{evt:t,target:i}),i.getLayer()?.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(t,r){var i=this._getNodeRect();let n=1;if(m._inRange(t.width,-this.padding()*2-n,n)){this.update();return}if(m._inRange(t.height,-this.padding()*2-n,n)){this.update();return}var s=new j;if(s.rotate(G.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){let g=s.point({x:-this.padding()*2,y:0});t.x+=g.x,t.y+=g.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=g.x,this._anchorDragOffset.y-=g.y}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){let g=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=g.x,this._anchorDragOffset.y-=g.y,t.width+=this.padding()*2}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){let g=s.point({x:0,y:-this.padding()*2});t.x+=g.x,t.y+=g.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=g.x,this._anchorDragOffset.y-=g.y,t.height+=this.padding()*2}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){let g=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=g.x,this._anchorDragOffset.y-=g.y,t.height+=this.padding()*2}if(this.boundBoxFunc()){let g=this.boundBoxFunc()(i,t);g?t=g:m.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}let o=1e7,h=new j;h.translate(i.x,i.y),h.rotate(i.rotation),h.scale(i.width/o,i.height/o);let l=new j,d=t.width/o,f=t.height/o;this.flipEnabled()===!1?(l.translate(t.x,t.y),l.rotate(t.rotation),l.translate(t.width<0?t.width:0,t.height<0?t.height:0),l.scale(Math.abs(d),Math.abs(f))):(l.translate(t.x,t.y),l.rotate(t.rotation),l.scale(d,f));let c=l.multiply(h.invert());this._nodes.forEach(g=>{let v=g.getParent().getAbsoluteTransform(),p=g.getTransform().copy();p.translate(g.offsetX(),g.offsetY());let b=new j;b.multiply(v.copy().invert()).multiply(c).multiply(v).multiply(p);let S=b.decompose();g.setAttrs(S),g.getLayer()?.batchDraw()}),this.rotation(m._getRotation(t.rotation)),this._nodes.forEach(g=>{this._fire("transform",{evt:r,target:g}),g._fire("transform",{evt:r,target:g})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,r){this.findOne(t).setAttrs(r)}update(){var t=this._getNodeRect();this.rotation(m._getRotation(t.rotation));var r=t.width,i=t.height,n=this.enabledAnchors(),s=this.resizeEnabled(),o=this.padding(),h=this.anchorSize();let l=this.find("._anchor");l.forEach(f=>{f.setAttrs({width:h,height:h,offsetX:h/2,offsetY:h/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:h/2+o,offsetY:h/2+o,visible:s&&n.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:h/2+o,visible:s&&n.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:h/2-o,offsetY:h/2+o,visible:s&&n.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:h/2+o,visible:s&&n.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:i/2,offsetX:h/2-o,visible:s&&n.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:h/2+o,offsetY:h/2-o,visible:s&&n.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:i,offsetY:h/2-o,visible:s&&n.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:i,offsetX:h/2-o,offsetY:h/2-o,visible:s&&n.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*m._sign(i)-o,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});let d=this.anchorStyleFunc();d&&l.forEach(f=>{d(f)}),this.getLayer()?.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),ht.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return y.prototype.toObject.call(this)}clone(t){var r=y.prototype.clone.call(this,t);return r}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};function zn(a){return a instanceof Array||m.warn("enabledAnchors value should be an array"),a instanceof Array&&a.forEach(function(e){pe.indexOf(e)===-1&&m.warn("Unknown anchor name: "+e+". Available names are: "+pe.join(", "))}),a||[]}F.prototype.className="Transformer";L(F);u.addGetterSetter(F,"enabledAnchors",pe,zn);u.addGetterSetter(F,"flipEnabled",!0,J());u.addGetterSetter(F,"resizeEnabled",!0);u.addGetterSetter(F,"anchorSize",10,_());u.addGetterSetter(F,"rotateEnabled",!0);u.addGetterSetter(F,"rotateLineVisible",!0);u.addGetterSetter(F,"rotationSnaps",[]);u.addGetterSetter(F,"rotateAnchorOffset",50,_());u.addGetterSetter(F,"rotateAnchorCursor","crosshair");u.addGetterSetter(F,"rotationSnapTolerance",5,_());u.addGetterSetter(F,"borderEnabled",!0);u.addGetterSetter(F,"anchorStroke","rgb(0, 161, 255)");u.addGetterSetter(F,"anchorStrokeWidth",1,_());u.addGetterSetter(F,"anchorFill","white");u.addGetterSetter(F,"anchorCornerRadius",0,_());u.addGetterSetter(F,"borderStroke","rgb(0, 161, 255)");u.addGetterSetter(F,"borderStrokeWidth",1,_());u.addGetterSetter(F,"borderDash");u.addGetterSetter(F,"keepRatio",!0);u.addGetterSetter(F,"shiftBehavior","default");u.addGetterSetter(F,"centeredScaling",!1);u.addGetterSetter(F,"ignoreStroke",!1);u.addGetterSetter(F,"padding",0,_());u.addGetterSetter(F,"node");u.addGetterSetter(F,"nodes");u.addGetterSetter(F,"boundBoxFunc");u.addGetterSetter(F,"anchorDragBoundFunc");u.addGetterSetter(F,"anchorStyleFunc");u.addGetterSetter(F,"shouldOverdrawWholeArea",!1);u.addGetterSetter(F,"useSingleNodeRotation",!0);u.backCompat(F,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});var nt=class extends C{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,G.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}};nt.prototype.className="Wedge";nt.prototype._centroid=!0;nt.prototype._attrsAffectingSize=["radius"];L(nt);u.addGetterSetter(nt,"radius",0,_());u.addGetterSetter(nt,"angle",0,_());u.addGetterSetter(nt,"clockwise",!1);u.backCompat(nt,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});function zr(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var Wn=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Yn=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function Xn(a,e){var t=a.data,r=a.width,i=a.height,n,s,o,h,l,d,f,c,g,v,p,b,S,P,x,w,T,E,k,N,R,M,A,O,X=e+e+1,W=r-1,Z=i-1,B=e+1,q=B*(B+1)/2,at=new zr,st=null,D=at,V=null,K=null,ut=Wn[e],_t=Yn[e];for(o=1;o<X;o++)D=D.next=new zr,o===B&&(st=D);for(D.next=at,f=d=0,s=0;s<i;s++){for(w=T=E=k=c=g=v=p=0,b=B*(N=t[d]),S=B*(R=t[d+1]),P=B*(M=t[d+2]),x=B*(A=t[d+3]),c+=q*N,g+=q*R,v+=q*M,p+=q*A,D=at,o=0;o<B;o++)D.r=N,D.g=R,D.b=M,D.a=A,D=D.next;for(o=1;o<B;o++)h=d+((W<o?W:o)<<2),c+=(D.r=N=t[h])*(O=B-o),g+=(D.g=R=t[h+1])*O,v+=(D.b=M=t[h+2])*O,p+=(D.a=A=t[h+3])*O,w+=N,T+=R,E+=M,k+=A,D=D.next;for(V=at,K=st,n=0;n<r;n++)t[d+3]=A=p*ut>>_t,A!==0?(A=255/A,t[d]=(c*ut>>_t)*A,t[d+1]=(g*ut>>_t)*A,t[d+2]=(v*ut>>_t)*A):t[d]=t[d+1]=t[d+2]=0,c-=b,g-=S,v-=P,p-=x,b-=V.r,S-=V.g,P-=V.b,x-=V.a,h=f+((h=n+e+1)<W?h:W)<<2,w+=V.r=t[h],T+=V.g=t[h+1],E+=V.b=t[h+2],k+=V.a=t[h+3],c+=w,g+=T,v+=E,p+=k,V=V.next,b+=N=K.r,S+=R=K.g,P+=M=K.b,x+=A=K.a,w-=N,T-=R,E-=M,k-=A,K=K.next,d+=4;f+=r}for(n=0;n<r;n++){for(T=E=k=w=g=v=p=c=0,d=n<<2,b=B*(N=t[d]),S=B*(R=t[d+1]),P=B*(M=t[d+2]),x=B*(A=t[d+3]),c+=q*N,g+=q*R,v+=q*M,p+=q*A,D=at,o=0;o<B;o++)D.r=N,D.g=R,D.b=M,D.a=A,D=D.next;for(l=r,o=1;o<=e;o++)d=l+n<<2,c+=(D.r=N=t[d])*(O=B-o),g+=(D.g=R=t[d+1])*O,v+=(D.b=M=t[d+2])*O,p+=(D.a=A=t[d+3])*O,w+=N,T+=R,E+=M,k+=A,D=D.next,o<Z&&(l+=r);for(d=n,V=at,K=st,s=0;s<i;s++)h=d<<2,t[h+3]=A=p*ut>>_t,A>0?(A=255/A,t[h]=(c*ut>>_t)*A,t[h+1]=(g*ut>>_t)*A,t[h+2]=(v*ut>>_t)*A):t[h]=t[h+1]=t[h+2]=0,c-=b,g-=S,v-=P,p-=x,b-=V.r,S-=V.g,P-=V.b,x-=V.a,h=n+((h=s+B)<Z?h:Z)*r<<2,c+=w+=V.r=t[h],g+=T+=V.g=t[h+1],v+=E+=V.b=t[h+2],p+=k+=V.a=t[h+3],V=V.next,b+=N=K.r,S+=R=K.g,P+=M=K.b,x+=A=K.a,w-=N,T-=R,E-=M,k-=A,K=K.next,d+=r}}var Wr=function(e){var t=Math.round(this.blurRadius());t>0&&Xn(e,t)};u.addGetterSetter(y,"blurRadius",0,_(),u.afterSetFilter);var Yr=function(a){var e=this.brightness()*255,t=a.data,r=t.length,i;for(i=0;i<r;i+=4)t[i]+=e,t[i+1]+=e,t[i+2]+=e};u.addGetterSetter(y,"brightness",0,_(),u.afterSetFilter);var Xr=function(a){var e=Math.pow((this.contrast()+100)/100,2),t=a.data,r=t.length,i=150,n=150,s=150,o;for(o=0;o<r;o+=4)i=t[o],n=t[o+1],s=t[o+2],i/=255,i-=.5,i*=e,i+=.5,i*=255,n/=255,n-=.5,n*=e,n+=.5,n*=255,s/=255,s-=.5,s*=e,s+=.5,s*=255,i=i<0?0:i>255?255:i,n=n<0?0:n>255?255:n,s=s<0?0:s>255?255:s,t[o]=i,t[o+1]=n,t[o+2]=s};u.addGetterSetter(y,"contrast",0,_(),u.afterSetFilter);var Ur=function(a){var e=this.embossStrength()*10,t=this.embossWhiteLevel()*255,r=this.embossDirection(),i=this.embossBlend(),n=0,s=0,o=a.data,h=a.width,l=a.height,d=h*4,f=l;switch(r){case"top-left":n=-1,s=-1;break;case"top":n=-1,s=0;break;case"top-right":n=-1,s=1;break;case"right":n=0,s=1;break;case"bottom-right":n=1,s=1;break;case"bottom":n=1,s=0;break;case"bottom-left":n=1,s=-1;break;case"left":n=0,s=-1;break;default:m.error("Unknown emboss direction: "+r)}do{var c=(f-1)*d,g=n;f+g<1&&(g=0),f+g>l&&(g=0);var v=(f-1+g)*h*4,p=h;do{var b=c+(p-1)*4,S=s;p+S<1&&(S=0),p+S>h&&(S=0);var P=v+(p-1+S)*4,x=o[b]-o[P],w=o[b+1]-o[P+1],T=o[b+2]-o[P+2],E=x,k=E>0?E:-E,N=w>0?w:-w,R=T>0?T:-T;if(N>k&&(E=w),R>k&&(E=T),E*=e,i){var M=o[b]+E,A=o[b+1]+E,O=o[b+2]+E;o[b]=M>255?255:M<0?0:M,o[b+1]=A>255?255:A<0?0:A,o[b+2]=O>255?255:O<0?0:O}else{var X=t-E;X<0?X=0:X>255&&(X=255),o[b]=o[b+1]=o[b+2]=X}}while(--p)}while(--f)};u.addGetterSetter(y,"embossStrength",.5,_(),u.afterSetFilter);u.addGetterSetter(y,"embossWhiteLevel",.5,_(),u.afterSetFilter);u.addGetterSetter(y,"embossDirection","top-left",null,u.afterSetFilter);u.addGetterSetter(y,"embossBlend",!1,null,u.afterSetFilter);function We(a,e,t,r,i){var n=t-e,s=i-r,o;return n===0?r+s/2:s===0?r:(o=(a-e)/n,o=s*o+r,o)}var qr=function(a){var e=a.data,t=e.length,r=e[0],i=r,n,s=e[1],o=s,h,l=e[2],d=l,f,c,g=this.enhance();if(g!==0){for(c=0;c<t;c+=4)n=e[c+0],n<r?r=n:n>i&&(i=n),h=e[c+1],h<s?s=h:h>o&&(o=h),f=e[c+2],f<l?l=f:f>d&&(d=f);i===r&&(i=255,r=0),o===s&&(o=255,s=0),d===l&&(d=255,l=0);var v,p,b,S,P,x,w,T,E;for(g>0?(p=i+g*(255-i),b=r-g*(r-0),P=o+g*(255-o),x=s-g*(s-0),T=d+g*(255-d),E=l-g*(l-0)):(v=(i+r)*.5,p=i+g*(i-v),b=r+g*(r-v),S=(o+s)*.5,P=o+g*(o-S),x=s+g*(s-S),w=(d+l)*.5,T=d+g*(d-w),E=l+g*(l-w)),c=0;c<t;c+=4)e[c+0]=We(e[c+0],r,i,b,p),e[c+1]=We(e[c+1],s,o,x,P),e[c+2]=We(e[c+2],l,d,E,T)}};u.addGetterSetter(y,"enhance",0,_(),u.afterSetFilter);var Kr=function(a){var e=a.data,t=e.length,r,i;for(r=0;r<t;r+=4)i=.34*e[r]+.5*e[r+1]+.16*e[r+2],e[r]=i,e[r+1]=i,e[r+2]=i};u.addGetterSetter(y,"hue",0,_(),u.afterSetFilter);u.addGetterSetter(y,"saturation",0,_(),u.afterSetFilter);u.addGetterSetter(y,"luminance",0,_(),u.afterSetFilter);var jr=function(a){var e=a.data,t=e.length,r=1,i=Math.pow(2,this.saturation()),n=Math.abs(this.hue()+360)%360,s=this.luminance()*127,o,h=r*i*Math.cos(n*Math.PI/180),l=r*i*Math.sin(n*Math.PI/180),d=.299*r+.701*h+.167*l,f=.587*r-.587*h+.33*l,c=.114*r-.114*h-.497*l,g=.299*r-.299*h-.328*l,v=.587*r+.413*h+.035*l,p=.114*r-.114*h+.293*l,b=.299*r-.3*h+1.25*l,S=.587*r-.586*h-1.05*l,P=.114*r+.886*h-.2*l,x,w,T,E;for(o=0;o<t;o+=4)x=e[o+0],w=e[o+1],T=e[o+2],E=e[o+3],e[o+0]=d*x+f*w+c*T+s,e[o+1]=g*x+v*w+p*T+s,e[o+2]=b*x+S*w+P*T+s,e[o+3]=E};var Jr=function(a){var e=a.data,t=e.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),n=Math.abs(this.hue()+360)%360,s,o=r*i*Math.cos(n*Math.PI/180),h=r*i*Math.sin(n*Math.PI/180),l=.299*r+.701*o+.167*h,d=.587*r-.587*o+.33*h,f=.114*r-.114*o-.497*h,c=.299*r-.299*o-.328*h,g=.587*r+.413*o+.035*h,v=.114*r-.114*o+.293*h,p=.299*r-.3*o+1.25*h,b=.587*r-.586*o-1.05*h,S=.114*r+.886*o-.2*h,P,x,w,T;for(s=0;s<t;s+=4)P=e[s+0],x=e[s+1],w=e[s+2],T=e[s+3],e[s+0]=l*P+d*x+f*w,e[s+1]=c*P+g*x+v*w,e[s+2]=p*P+b*x+S*w,e[s+3]=T};u.addGetterSetter(y,"hue",0,_(),u.afterSetFilter);u.addGetterSetter(y,"saturation",0,_(),u.afterSetFilter);u.addGetterSetter(y,"value",0,_(),u.afterSetFilter);var Qr=function(a){var e=a.data,t=e.length,r;for(r=0;r<t;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]};var Un=function(a,e,t){var r=a.data,i=e.data,n=a.width,s=a.height,o=t.polarCenterX||n/2,h=t.polarCenterY||s/2,l,d,f,c=0,g=0,v=0,p=0,b,S=Math.sqrt(o*o+h*h);d=n-o,f=s-h,b=Math.sqrt(d*d+f*f),S=b>S?b:S;var P=s,x=n,w,T,E=360/x*Math.PI/180,k,N;for(T=0;T<x;T+=1)for(k=Math.sin(T*E),N=Math.cos(T*E),w=0;w<P;w+=1)d=Math.floor(o+S*w/P*N),f=Math.floor(h+S*w/P*k),l=(f*n+d)*4,c=r[l+0],g=r[l+1],v=r[l+2],p=r[l+3],l=(T+w*n)*4,i[l+0]=c,i[l+1]=g,i[l+2]=v,i[l+3]=p},qn=function(a,e,t){var r=a.data,i=e.data,n=a.width,s=a.height,o=t.polarCenterX||n/2,h=t.polarCenterY||s/2,l,d,f,c,g,v=0,p=0,b=0,S=0,P,x=Math.sqrt(o*o+h*h);d=n-o,f=s-h,P=Math.sqrt(d*d+f*f),x=P>x?P:x;var w=s,T=n,E,k,N=t.polarRotation||0,R,M;for(d=0;d<n;d+=1)for(f=0;f<s;f+=1)c=d-o,g=f-h,E=Math.sqrt(c*c+g*g)*w/x,k=(Math.atan2(g,c)*180/Math.PI+360+N)%360,k=k*T/360,R=Math.floor(k),M=Math.floor(E),l=(M*n+R)*4,v=r[l+0],p=r[l+1],b=r[l+2],S=r[l+3],l=(f*n+d)*4,i[l+0]=v,i[l+1]=p,i[l+2]=b,i[l+3]=S},Zr=function(a){var e=a.width,t=a.height,r,i,n,s,o,h,l,d,f,c,g=Math.round(this.kaleidoscopePower()),v=Math.round(this.kaleidoscopeAngle()),p=Math.floor(e*(v%360)/360);if(!(g<1)){var b=m.createCanvasElement();b.width=e,b.height=t;var S=b.getContext("2d").getImageData(0,0,e,t);m.releaseCanvas(b),Un(a,S,{polarCenterX:e/2,polarCenterY:t/2});for(var P=e/Math.pow(2,g);P<=8;)P=P*2,g-=1;P=Math.ceil(P);var x=P,w=0,T=x,E=1;for(p+P>e&&(w=x,T=0,E=-1),i=0;i<t;i+=1)for(r=w;r!==T;r+=E)n=Math.round(r+p)%e,f=(e*i+n)*4,o=S.data[f+0],h=S.data[f+1],l=S.data[f+2],d=S.data[f+3],c=(e*i+r)*4,S.data[c+0]=o,S.data[c+1]=h,S.data[c+2]=l,S.data[c+3]=d;for(i=0;i<t;i+=1)for(x=Math.floor(P),s=0;s<g;s+=1){for(r=0;r<x+1;r+=1)f=(e*i+r)*4,o=S.data[f+0],h=S.data[f+1],l=S.data[f+2],d=S.data[f+3],c=(e*i+x*2-r-1)*4,S.data[c+0]=o,S.data[c+1]=h,S.data[c+2]=l,S.data[c+3]=d;x*=2}qn(S,a,{polarRotation:0})}};u.addGetterSetter(y,"kaleidoscopePower",2,_(),u.afterSetFilter);u.addGetterSetter(y,"kaleidoscopeAngle",0,_(),u.afterSetFilter);function be(a,e,t){var r=(t*a.width+e)*4,i=[];return i.push(a.data[r++],a.data[r++],a.data[r++],a.data[r++]),i}function Jt(a,e){return Math.sqrt(Math.pow(a[0]-e[0],2)+Math.pow(a[1]-e[1],2)+Math.pow(a[2]-e[2],2))}function Kn(a){for(var e=[0,0,0],t=0;t<a.length;t++)e[0]+=a[t][0],e[1]+=a[t][1],e[2]+=a[t][2];return e[0]/=a.length,e[1]/=a.length,e[2]/=a.length,e}function jn(a,e){var t=be(a,0,0),r=be(a,a.width-1,0),i=be(a,0,a.height-1),n=be(a,a.width-1,a.height-1),s=e||10;if(Jt(t,r)<s&&Jt(r,n)<s&&Jt(n,i)<s&&Jt(i,t)<s){for(var o=Kn([r,t,n,i]),h=[],l=0;l<a.width*a.height;l++){var d=Jt(o,[a.data[l*4],a.data[l*4+1],a.data[l*4+2]]);h[l]=d<s?0:255}return h}}function Jn(a,e){for(var t=0;t<a.width*a.height;t++)a.data[4*t+3]=e[t]}function Qn(a,e,t){for(var r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),n=Math.floor(i/2),s=[],o=0;o<t;o++)for(var h=0;h<e;h++){for(var l=o*e+h,d=0,f=0;f<i;f++)for(var c=0;c<i;c++){var g=o+f-n,v=h+c-n;if(g>=0&&g<t&&v>=0&&v<e){var p=g*e+v,b=r[f*i+c];d+=a[p]*b}}s[l]=d===255*8?255:0}return s}function Zn(a,e,t){for(var r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),n=Math.floor(i/2),s=[],o=0;o<t;o++)for(var h=0;h<e;h++){for(var l=o*e+h,d=0,f=0;f<i;f++)for(var c=0;c<i;c++){var g=o+f-n,v=h+c-n;if(g>=0&&g<t&&v>=0&&v<e){var p=g*e+v,b=r[f*i+c];d+=a[p]*b}}s[l]=d>=255*4?255:0}return s}function $n(a,e,t){for(var r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(r.length)),n=Math.floor(i/2),s=[],o=0;o<t;o++)for(var h=0;h<e;h++){for(var l=o*e+h,d=0,f=0;f<i;f++)for(var c=0;c<i;c++){var g=o+f-n,v=h+c-n;if(g>=0&&g<t&&v>=0&&v<e){var p=g*e+v,b=r[f*i+c];d+=a[p]*b}}s[l]=d}return s}var $r=function(a){var e=this.threshold(),t=jn(a,e);return t&&(t=Qn(t,a.width,a.height),t=Zn(t,a.width,a.height),t=$n(t,a.width,a.height),Jn(a,t)),a};u.addGetterSetter(y,"threshold",0,_(),u.afterSetFilter);var ti=function(a){var e=this.noise()*255,t=a.data,r=t.length,i=e/2,n;for(n=0;n<r;n+=4)t[n+0]+=i-2*i*Math.random(),t[n+1]+=i-2*i*Math.random(),t[n+2]+=i-2*i*Math.random()};u.addGetterSetter(y,"noise",.2,_(),u.afterSetFilter);var ei=function(a){var e=Math.ceil(this.pixelSize()),t=a.width,r=a.height,i,n,s,o,h,l,d,f=Math.ceil(t/e),c=Math.ceil(r/e),g,v,p,b,S,P,x,w=a.data;if(e<=0){m.error("pixelSize value can not be <= 0");return}for(S=0;S<f;S+=1)for(P=0;P<c;P+=1){for(o=0,h=0,l=0,d=0,g=S*e,v=g+e,p=P*e,b=p+e,x=0,i=g;i<v;i+=1)if(!(i>=t))for(n=p;n<b;n+=1)n>=r||(s=(t*n+i)*4,o+=w[s+0],h+=w[s+1],l+=w[s+2],d+=w[s+3],x+=1);for(o=o/x,h=h/x,l=l/x,d=d/x,i=g;i<v;i+=1)if(!(i>=t))for(n=p;n<b;n+=1)n>=r||(s=(t*n+i)*4,w[s+0]=o,w[s+1]=h,w[s+2]=l,w[s+3]=d)}};u.addGetterSetter(y,"pixelSize",8,_(),u.afterSetFilter);var ri=function(a){var e=Math.round(this.levels()*254)+1,t=a.data,r=t.length,i=255/e,n;for(n=0;n<r;n+=1)t[n]=Math.floor(t[n]/i)*i};u.addGetterSetter(y,"levels",.5,_(),u.afterSetFilter);var ii=function(a){var e=a.data,t=e.length,r=this.red(),i=this.green(),n=this.blue(),s,o;for(s=0;s<t;s+=4)o=(.34*e[s]+.5*e[s+1]+.16*e[s+2])/255,e[s]=o*r,e[s+1]=o*i,e[s+2]=o*n,e[s+3]=e[s+3]};u.addGetterSetter(y,"red",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});u.addGetterSetter(y,"green",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});u.addGetterSetter(y,"blue",0,Zt,u.afterSetFilter);var ni=function(a){var e=a.data,t=e.length,r=this.red(),i=this.green(),n=this.blue(),s=this.alpha(),o,h;for(o=0;o<t;o+=4)h=1-s,e[o]=r*s+e[o]*h,e[o+1]=i*s+e[o+1]*h,e[o+2]=n*s+e[o+2]*h};u.addGetterSetter(y,"red",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});u.addGetterSetter(y,"green",0,function(a){return this._filterUpToDate=!1,a>255?255:a<0?0:Math.round(a)});u.addGetterSetter(y,"blue",0,Zt,u.afterSetFilter);u.addGetterSetter(y,"alpha",1,function(a){return this._filterUpToDate=!1,a>1?1:a<0?0:a});var ai=function(a){var e=a.data,t=e.length,r,i,n,s;for(r=0;r<t;r+=4)i=e[r+0],n=e[r+1],s=e[r+2],e[r+0]=Math.min(255,i*.393+n*.769+s*.189),e[r+1]=Math.min(255,i*.349+n*.686+s*.168),e[r+2]=Math.min(255,i*.272+n*.534+s*.131)};var si=function(a){var e=a.data,t=a.width,r=a.height,i=t*4,n=r;do{var s=(n-1)*i,o=t;do{var h=s+(o-1)*4,l=e[h],d=e[h+1],f=e[h+2];l>127&&(l=255-l),d>127&&(d=255-d),f>127&&(f=255-f),e[h]=l,e[h+1]=d,e[h+2]=f}while(--o)}while(--n)};var oi=function(a){var e=this.threshold()*255,t=a.data,r=t.length,i;for(i=0;i<r;i+=1)t[i]=t[i]<e?0:255};u.addGetterSetter(y,"threshold",.5,_(),u.afterSetFilter);var hi=Ae.Util._assign(Ae,{Arc:it,Arrow:ct,Circle:vt,Ellipse:lt,Image:tt,Label:It,Tag:gt,Line:$,Path:Q,Rect:St,RegularPolygon:mt,Ring:pt,Sprite:et,Star:dt,Text:H,TextPath:Y,Transformer:F,Wedge:nt,Filters:{Blur:Wr,Brighten:Yr,Contrast:Xr,Emboss:Ur,Enhance:qr,Grayscale:Kr,HSL:jr,HSV:Jr,Invert:Qr,Kaleidoscope:Zr,Mask:$r,Noise:ti,Pixelate:ei,Posterize:ri,RGB:ii,RGBA:ni,Sepia:ai,Solarize:si,Threshold:oi}});var gd=hi;export{gd as default};
/*
 * Konva JavaScript Framework v@@version
 * http://konvajs.org/
 * Licensed under the MIT
 * Date: @@date
 *
 * Original work Copyright (C) 2011 - 2013 by Eric Rowell (KineticJS)
 * Modified work Copyright (C) 2014 - present by Anton Lavrenov (Konva)
 *
 * @license
 */
